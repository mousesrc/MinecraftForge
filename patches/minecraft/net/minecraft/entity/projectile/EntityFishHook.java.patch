--- ../src-base/minecraft/net/minecraft/entity/projectile/EntityFishHook.java
+++ ../src-work/minecraft/net/minecraft/entity/projectile/EntityFishHook.java
@@ -32,47 +32,50 @@
 import net.minecraft.world.storage.loot.LootTableList;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
+import org.bukkit.entity.Fish;
+import org.bukkit.entity.Player;
+import org.bukkit.event.player.PlayerFishEvent;
 
 public class EntityFishHook extends Entity
 {
-    private static final DataParameter<Integer> field_184528_c = EntityDataManager.<Integer>func_187226_a(EntityFishHook.class, DataSerializers.field_187192_b);
-    private boolean field_146051_au;
-    private int field_146049_av = 0;
-    public EntityPlayer field_146042_b;
-    private int field_146047_aw;
-    private int field_146045_ax;
-    private int field_146040_ay;
-    private int field_146038_az;
-    private float field_146054_aA;
-    public Entity field_146043_c;
-    private EntityFishHook.State field_190627_av = EntityFishHook.State.FLYING;
+    private static final DataParameter<Integer> DATA_HOOKED_ENTITY = EntityDataManager.<Integer>createKey(EntityFishHook.class, DataSerializers.VARINT);
+    private boolean inGround;
+    private int ticksInGround = 0;
+    public EntityPlayer angler;
+    private int ticksInAir;
+    private int ticksCatchable;
+    private int ticksCaughtDelay;
+    private int ticksCatchableDelay;
+    private float fishApproachAngle;
+    public Entity caughtEntity;
+    private EntityFishHook.State currentState = EntityFishHook.State.FLYING;
     private int field_191518_aw;
     private int field_191519_ax;
 
     @SideOnly(Side.CLIENT)
-    public EntityFishHook(World p_i47290_1_, EntityPlayer p_i47290_2_, double p_i47290_3_, double p_i47290_5_, double p_i47290_7_)
+    public EntityFishHook(World worldIn, EntityPlayer p_i47290_2_, double x, double y, double z)
     {
-        super(p_i47290_1_);
-        this.func_190626_a(p_i47290_2_);
-        this.func_70107_b(p_i47290_3_, p_i47290_5_, p_i47290_7_);
-        this.field_70169_q = this.field_70165_t;
-        this.field_70167_r = this.field_70163_u;
-        this.field_70166_s = this.field_70161_v;
+        super(worldIn);
+        this.init(p_i47290_2_);
+        this.setPosition(x, y, z);
+        this.prevPosX = this.posX;
+        this.prevPosY = this.posY;
+        this.prevPosZ = this.posZ;
     }
 
-    public EntityFishHook(World p_i1766_1_, EntityPlayer p_i1766_2_)
+    public EntityFishHook(World worldIn, EntityPlayer fishingPlayer)
     {
-        super(p_i1766_1_);
-        this.func_190626_a(p_i1766_2_);
-        this.func_190620_n();
+        super(worldIn);
+        this.init(fishingPlayer);
+        this.shoot();
     }
 
-    private void func_190626_a(EntityPlayer p_190626_1_)
+    private void init(EntityPlayer p_190626_1_)
     {
-        this.func_70105_a(0.25F, 0.25F);
-        this.field_70158_ak = true;
-        this.field_146042_b = p_190626_1_;
-        this.field_146042_b.field_71104_cf = this;
+        this.setSize(0.25F, 0.25F);
+        this.ignoreFrustumCheck = true;
+        this.angler = p_190626_1_;
+        this.angler.fishEntity = this;
     }
 
     public void func_191516_a(int p_191516_1_)
@@ -85,260 +88,260 @@
         this.field_191518_aw = p_191517_1_;
     }
 
-    private void func_190620_n()
+    private void shoot()
     {
-        float f = this.field_146042_b.field_70127_C + (this.field_146042_b.field_70125_A - this.field_146042_b.field_70127_C);
-        float f1 = this.field_146042_b.field_70126_B + (this.field_146042_b.field_70177_z - this.field_146042_b.field_70126_B);
-        float f2 = MathHelper.func_76134_b(-f1 * 0.017453292F - (float)Math.PI);
-        float f3 = MathHelper.func_76126_a(-f1 * 0.017453292F - (float)Math.PI);
-        float f4 = -MathHelper.func_76134_b(-f * 0.017453292F);
-        float f5 = MathHelper.func_76126_a(-f * 0.017453292F);
-        double d0 = this.field_146042_b.field_70169_q + (this.field_146042_b.field_70165_t - this.field_146042_b.field_70169_q) - (double)f3 * 0.3D;
-        double d1 = this.field_146042_b.field_70167_r + (this.field_146042_b.field_70163_u - this.field_146042_b.field_70167_r) + (double)this.field_146042_b.func_70047_e();
-        double d2 = this.field_146042_b.field_70166_s + (this.field_146042_b.field_70161_v - this.field_146042_b.field_70166_s) - (double)f2 * 0.3D;
-        this.func_70012_b(d0, d1, d2, f1, f);
-        this.field_70159_w = (double)(-f3);
-        this.field_70181_x = (double)MathHelper.func_76131_a(-(f5 / f4), -5.0F, 5.0F);
-        this.field_70179_y = (double)(-f2);
-        float f6 = MathHelper.func_76133_a(this.field_70159_w * this.field_70159_w + this.field_70181_x * this.field_70181_x + this.field_70179_y * this.field_70179_y);
-        this.field_70159_w *= 0.6D / (double)f6 + 0.5D + this.field_70146_Z.nextGaussian() * 0.0045D;
-        this.field_70181_x *= 0.6D / (double)f6 + 0.5D + this.field_70146_Z.nextGaussian() * 0.0045D;
-        this.field_70179_y *= 0.6D / (double)f6 + 0.5D + this.field_70146_Z.nextGaussian() * 0.0045D;
-        float f7 = MathHelper.func_76133_a(this.field_70159_w * this.field_70159_w + this.field_70179_y * this.field_70179_y);
-        this.field_70177_z = (float)(MathHelper.func_181159_b(this.field_70159_w, this.field_70179_y) * (180D / Math.PI));
-        this.field_70125_A = (float)(MathHelper.func_181159_b(this.field_70181_x, (double)f7) * (180D / Math.PI));
-        this.field_70126_B = this.field_70177_z;
-        this.field_70127_C = this.field_70125_A;
+        float f = this.angler.prevRotationPitch + (this.angler.rotationPitch - this.angler.prevRotationPitch);
+        float f1 = this.angler.prevRotationYaw + (this.angler.rotationYaw - this.angler.prevRotationYaw);
+        float f2 = MathHelper.cos(-f1 * 0.017453292F - (float)Math.PI);
+        float f3 = MathHelper.sin(-f1 * 0.017453292F - (float)Math.PI);
+        float f4 = -MathHelper.cos(-f * 0.017453292F);
+        float f5 = MathHelper.sin(-f * 0.017453292F);
+        double d0 = this.angler.prevPosX + (this.angler.posX - this.angler.prevPosX) - (double)f3 * 0.3D;
+        double d1 = this.angler.prevPosY + (this.angler.posY - this.angler.prevPosY) + (double)this.angler.getEyeHeight();
+        double d2 = this.angler.prevPosZ + (this.angler.posZ - this.angler.prevPosZ) - (double)f2 * 0.3D;
+        this.setLocationAndAngles(d0, d1, d2, f1, f);
+        this.motionX = (double)(-f3);
+        this.motionY = (double)MathHelper.clamp(-(f5 / f4), -5.0F, 5.0F);
+        this.motionZ = (double)(-f2);
+        float f6 = MathHelper.sqrt(this.motionX * this.motionX + this.motionY * this.motionY + this.motionZ * this.motionZ);
+        this.motionX *= 0.6D / (double)f6 + 0.5D + this.rand.nextGaussian() * 0.0045D;
+        this.motionY *= 0.6D / (double)f6 + 0.5D + this.rand.nextGaussian() * 0.0045D;
+        this.motionZ *= 0.6D / (double)f6 + 0.5D + this.rand.nextGaussian() * 0.0045D;
+        float f7 = MathHelper.sqrt(this.motionX * this.motionX + this.motionZ * this.motionZ);
+        this.rotationYaw = (float)(MathHelper.atan2(this.motionX, this.motionZ) * (180D / Math.PI));
+        this.rotationPitch = (float)(MathHelper.atan2(this.motionY, (double)f7) * (180D / Math.PI));
+        this.prevRotationYaw = this.rotationYaw;
+        this.prevRotationPitch = this.rotationPitch;
     }
 
-    protected void func_70088_a()
+    protected void entityInit()
     {
-        this.func_184212_Q().func_187214_a(field_184528_c, Integer.valueOf(0));
+        this.getDataManager().register(DATA_HOOKED_ENTITY, Integer.valueOf(0));
     }
 
-    public void func_184206_a(DataParameter<?> p_184206_1_)
+    public void notifyDataManagerChange(DataParameter<?> key)
     {
-        if (field_184528_c.equals(p_184206_1_))
+        if (DATA_HOOKED_ENTITY.equals(key))
         {
-            int i = ((Integer)this.func_184212_Q().func_187225_a(field_184528_c)).intValue();
-            this.field_146043_c = i > 0 ? this.field_70170_p.func_73045_a(i - 1) : null;
+            int i = ((Integer)this.getDataManager().get(DATA_HOOKED_ENTITY)).intValue();
+            this.caughtEntity = i > 0 ? this.world.getEntityByID(i - 1) : null;
         }
 
-        super.func_184206_a(p_184206_1_);
+        super.notifyDataManagerChange(key);
     }
 
     @SideOnly(Side.CLIENT)
-    public boolean func_70112_a(double p_70112_1_)
+    public boolean isInRangeToRenderDist(double distance)
     {
         double d0 = 64.0D;
-        return p_70112_1_ < 4096.0D;
+        return distance < 4096.0D;
     }
 
     @SideOnly(Side.CLIENT)
-    public void func_180426_a(double p_180426_1_, double p_180426_3_, double p_180426_5_, float p_180426_7_, float p_180426_8_, int p_180426_9_, boolean p_180426_10_)
+    public void setPositionAndRotationDirect(double x, double y, double z, float yaw, float pitch, int posRotationIncrements, boolean teleport)
     {
     }
 
-    public void func_70071_h_()
+    public void onUpdate()
     {
-        super.func_70071_h_();
+        super.onUpdate();
 
-        if (this.field_146042_b == null)
+        if (this.angler == null)
         {
-            this.func_70106_y();
+            this.setDead();
         }
-        else if (this.field_70170_p.field_72995_K || !this.func_190625_o())
+        else if (this.world.isRemote || !this.shouldStopFishing())
         {
-            if (this.field_146051_au)
+            if (this.inGround)
             {
-                ++this.field_146049_av;
+                ++this.ticksInGround;
 
-                if (this.field_146049_av >= 1200)
+                if (this.ticksInGround >= 1200)
                 {
-                    this.func_70106_y();
+                    this.setDead();
                     return;
                 }
             }
 
             float f = 0.0F;
             BlockPos blockpos = new BlockPos(this);
-            IBlockState iblockstate = this.field_70170_p.func_180495_p(blockpos);
+            IBlockState iblockstate = this.world.getBlockState(blockpos);
 
-            if (iblockstate.func_185904_a() == Material.field_151586_h)
+            if (iblockstate.getMaterial() == Material.WATER)
             {
-                f = BlockLiquid.func_190973_f(iblockstate, this.field_70170_p, blockpos);
+                f = BlockLiquid.getBlockLiquidHeight(iblockstate, this.world, blockpos);
             }
 
-            if (this.field_190627_av == EntityFishHook.State.FLYING)
+            if (this.currentState == EntityFishHook.State.FLYING)
             {
-                if (this.field_146043_c != null)
+                if (this.caughtEntity != null)
                 {
-                    this.field_70159_w = 0.0D;
-                    this.field_70181_x = 0.0D;
-                    this.field_70179_y = 0.0D;
-                    this.field_190627_av = EntityFishHook.State.HOOKED_IN_ENTITY;
+                    this.motionX = 0.0D;
+                    this.motionY = 0.0D;
+                    this.motionZ = 0.0D;
+                    this.currentState = EntityFishHook.State.HOOKED_IN_ENTITY;
                     return;
                 }
 
                 if (f > 0.0F)
                 {
-                    this.field_70159_w *= 0.3D;
-                    this.field_70181_x *= 0.2D;
-                    this.field_70179_y *= 0.3D;
-                    this.field_190627_av = EntityFishHook.State.BOBBING;
+                    this.motionX *= 0.3D;
+                    this.motionY *= 0.2D;
+                    this.motionZ *= 0.3D;
+                    this.currentState = EntityFishHook.State.BOBBING;
                     return;
                 }
 
-                if (!this.field_70170_p.field_72995_K)
+                if (!this.world.isRemote)
                 {
-                    this.func_190624_r();
+                    this.checkCollision();
                 }
 
-                if (!this.field_146051_au && !this.field_70122_E && !this.field_70123_F)
+                if (!this.inGround && !this.onGround && !this.isCollidedHorizontally)
                 {
-                    ++this.field_146047_aw;
+                    ++this.ticksInAir;
                 }
                 else
                 {
-                    this.field_146047_aw = 0;
-                    this.field_70159_w = 0.0D;
-                    this.field_70181_x = 0.0D;
-                    this.field_70179_y = 0.0D;
+                    this.ticksInAir = 0;
+                    this.motionX = 0.0D;
+                    this.motionY = 0.0D;
+                    this.motionZ = 0.0D;
                 }
             }
             else
             {
-                if (this.field_190627_av == EntityFishHook.State.HOOKED_IN_ENTITY)
+                if (this.currentState == EntityFishHook.State.HOOKED_IN_ENTITY)
                 {
-                    if (this.field_146043_c != null)
+                    if (this.caughtEntity != null)
                     {
-                        if (this.field_146043_c.field_70128_L)
+                        if (this.caughtEntity.isDead)
                         {
-                            this.field_146043_c = null;
-                            this.field_190627_av = EntityFishHook.State.FLYING;
+                            this.caughtEntity = null;
+                            this.currentState = EntityFishHook.State.FLYING;
                         }
                         else
                         {
-                            this.field_70165_t = this.field_146043_c.field_70165_t;
-                            double d2 = (double)this.field_146043_c.field_70131_O;
-                            this.field_70163_u = this.field_146043_c.func_174813_aQ().field_72338_b + d2 * 0.8D;
-                            this.field_70161_v = this.field_146043_c.field_70161_v;
-                            this.func_70107_b(this.field_70165_t, this.field_70163_u, this.field_70161_v);
+                            this.posX = this.caughtEntity.posX;
+                            double d2 = (double)this.caughtEntity.height;
+                            this.posY = this.caughtEntity.getEntityBoundingBox().minY + d2 * 0.8D;
+                            this.posZ = this.caughtEntity.posZ;
+                            this.setPosition(this.posX, this.posY, this.posZ);
                         }
                     }
 
                     return;
                 }
 
-                if (this.field_190627_av == EntityFishHook.State.BOBBING)
+                if (this.currentState == EntityFishHook.State.BOBBING)
                 {
-                    this.field_70159_w *= 0.9D;
-                    this.field_70179_y *= 0.9D;
-                    double d0 = this.field_70163_u + this.field_70181_x - (double)blockpos.func_177956_o() - (double)f;
+                    this.motionX *= 0.9D;
+                    this.motionZ *= 0.9D;
+                    double d0 = this.posY + this.motionY - (double)blockpos.getY() - (double)f;
 
                     if (Math.abs(d0) < 0.01D)
                     {
                         d0 += Math.signum(d0) * 0.1D;
                     }
 
-                    this.field_70181_x -= d0 * (double)this.field_70146_Z.nextFloat() * 0.2D;
+                    this.motionY -= d0 * (double)this.rand.nextFloat() * 0.2D;
 
-                    if (!this.field_70170_p.field_72995_K && f > 0.0F)
+                    if (!this.world.isRemote && f > 0.0F)
                     {
-                        this.func_190621_a(blockpos);
+                        this.catchingFish(blockpos);
                     }
                 }
             }
 
-            if (iblockstate.func_185904_a() != Material.field_151586_h)
+            if (iblockstate.getMaterial() != Material.WATER)
             {
-                this.field_70181_x -= 0.03D;
+                this.motionY -= 0.03D;
             }
 
-            this.func_70091_d(MoverType.SELF, this.field_70159_w, this.field_70181_x, this.field_70179_y);
-            this.func_190623_q();
+            this.move(MoverType.SELF, this.motionX, this.motionY, this.motionZ);
+            this.updateRotation();
             double d1 = 0.92D;
-            this.field_70159_w *= 0.92D;
-            this.field_70181_x *= 0.92D;
-            this.field_70179_y *= 0.92D;
-            this.func_70107_b(this.field_70165_t, this.field_70163_u, this.field_70161_v);
+            this.motionX *= 0.92D;
+            this.motionY *= 0.92D;
+            this.motionZ *= 0.92D;
+            this.setPosition(this.posX, this.posY, this.posZ);
         }
     }
 
-    private boolean func_190625_o()
+    private boolean shouldStopFishing()
     {
-        ItemStack itemstack = this.field_146042_b.func_184614_ca();
-        ItemStack itemstack1 = this.field_146042_b.func_184592_cb();
-        boolean flag = itemstack.func_77973_b() == Items.field_151112_aM;
-        boolean flag1 = itemstack1.func_77973_b() == Items.field_151112_aM;
+        ItemStack itemstack = this.angler.getHeldItemMainhand();
+        ItemStack itemstack1 = this.angler.getHeldItemOffhand();
+        boolean flag = itemstack.getItem() instanceof net.minecraft.item.ItemFishingRod;
+        boolean flag1 = itemstack1.getItem() instanceof net.minecraft.item.ItemFishingRod;
 
-        if (!this.field_146042_b.field_70128_L && this.field_146042_b.func_70089_S() && (flag || flag1) && this.func_70068_e(this.field_146042_b) <= 1024.0D)
+        if (!this.angler.isDead && this.angler.isEntityAlive() && (flag || flag1) && this.getDistanceSqToEntity(this.angler) <= 1024.0D)
         {
             return false;
         }
         else
         {
-            this.func_70106_y();
+            this.setDead();
             return true;
         }
     }
 
-    private void func_190623_q()
+    private void updateRotation()
     {
-        float f = MathHelper.func_76133_a(this.field_70159_w * this.field_70159_w + this.field_70179_y * this.field_70179_y);
-        this.field_70177_z = (float)(MathHelper.func_181159_b(this.field_70159_w, this.field_70179_y) * (180D / Math.PI));
+        float f = MathHelper.sqrt(this.motionX * this.motionX + this.motionZ * this.motionZ);
+        this.rotationYaw = (float)(MathHelper.atan2(this.motionX, this.motionZ) * (180D / Math.PI));
 
-        for (this.field_70125_A = (float)(MathHelper.func_181159_b(this.field_70181_x, (double)f) * (180D / Math.PI)); this.field_70125_A - this.field_70127_C < -180.0F; this.field_70127_C -= 360.0F)
+        for (this.rotationPitch = (float)(MathHelper.atan2(this.motionY, (double)f) * (180D / Math.PI)); this.rotationPitch - this.prevRotationPitch < -180.0F; this.prevRotationPitch -= 360.0F)
         {
             ;
         }
 
-        while (this.field_70125_A - this.field_70127_C >= 180.0F)
+        while (this.rotationPitch - this.prevRotationPitch >= 180.0F)
         {
-            this.field_70127_C += 360.0F;
+            this.prevRotationPitch += 360.0F;
         }
 
-        while (this.field_70177_z - this.field_70126_B < -180.0F)
+        while (this.rotationYaw - this.prevRotationYaw < -180.0F)
         {
-            this.field_70126_B -= 360.0F;
+            this.prevRotationYaw -= 360.0F;
         }
 
-        while (this.field_70177_z - this.field_70126_B >= 180.0F)
+        while (this.rotationYaw - this.prevRotationYaw >= 180.0F)
         {
-            this.field_70126_B += 360.0F;
+            this.prevRotationYaw += 360.0F;
         }
 
-        this.field_70125_A = this.field_70127_C + (this.field_70125_A - this.field_70127_C) * 0.2F;
-        this.field_70177_z = this.field_70126_B + (this.field_70177_z - this.field_70126_B) * 0.2F;
+        this.rotationPitch = this.prevRotationPitch + (this.rotationPitch - this.prevRotationPitch) * 0.2F;
+        this.rotationYaw = this.prevRotationYaw + (this.rotationYaw - this.prevRotationYaw) * 0.2F;
     }
 
-    private void func_190624_r()
+    private void checkCollision()
     {
-        Vec3d vec3d = new Vec3d(this.field_70165_t, this.field_70163_u, this.field_70161_v);
-        Vec3d vec3d1 = new Vec3d(this.field_70165_t + this.field_70159_w, this.field_70163_u + this.field_70181_x, this.field_70161_v + this.field_70179_y);
-        RayTraceResult raytraceresult = this.field_70170_p.func_147447_a(vec3d, vec3d1, false, true, false);
-        vec3d = new Vec3d(this.field_70165_t, this.field_70163_u, this.field_70161_v);
-        vec3d1 = new Vec3d(this.field_70165_t + this.field_70159_w, this.field_70163_u + this.field_70181_x, this.field_70161_v + this.field_70179_y);
+        Vec3d vec3d = new Vec3d(this.posX, this.posY, this.posZ);
+        Vec3d vec3d1 = new Vec3d(this.posX + this.motionX, this.posY + this.motionY, this.posZ + this.motionZ);
+        RayTraceResult raytraceresult = this.world.rayTraceBlocks(vec3d, vec3d1, false, true, false);
+        vec3d = new Vec3d(this.posX, this.posY, this.posZ);
+        vec3d1 = new Vec3d(this.posX + this.motionX, this.posY + this.motionY, this.posZ + this.motionZ);
 
         if (raytraceresult != null)
         {
-            vec3d1 = new Vec3d(raytraceresult.field_72307_f.field_72450_a, raytraceresult.field_72307_f.field_72448_b, raytraceresult.field_72307_f.field_72449_c);
+            vec3d1 = new Vec3d(raytraceresult.hitVec.xCoord, raytraceresult.hitVec.yCoord, raytraceresult.hitVec.zCoord);
         }
 
         Entity entity = null;
-        List<Entity> list = this.field_70170_p.func_72839_b(this, this.func_174813_aQ().func_72321_a(this.field_70159_w, this.field_70181_x, this.field_70179_y).func_186662_g(1.0D));
+        List<Entity> list = this.world.getEntitiesWithinAABBExcludingEntity(this, this.getEntityBoundingBox().addCoord(this.motionX, this.motionY, this.motionZ).expandXyz(1.0D));
         double d0 = 0.0D;
 
         for (Entity entity1 : list)
         {
-            if (this.func_189739_a(entity1) && (entity1 != this.field_146042_b || this.field_146047_aw >= 5))
+            if (this.canBeHooked(entity1) && (entity1 != this.angler || this.ticksInAir >= 5))
             {
-                AxisAlignedBB axisalignedbb = entity1.func_174813_aQ().func_186662_g(0.30000001192092896D);
-                RayTraceResult raytraceresult1 = axisalignedbb.func_72327_a(vec3d, vec3d1);
+                AxisAlignedBB axisalignedbb = entity1.getEntityBoundingBox().expandXyz(0.30000001192092896D);
+                RayTraceResult raytraceresult1 = axisalignedbb.calculateIntercept(vec3d, vec3d1);
 
                 if (raytraceresult1 != null)
                 {
-                    double d1 = vec3d.func_72436_e(raytraceresult1.field_72307_f);
+                    double d1 = vec3d.squareDistanceTo(raytraceresult1.hitVec);
 
                     if (d1 < d0 || d0 == 0.0D)
                     {
@@ -354,200 +357,259 @@
             raytraceresult = new RayTraceResult(entity);
         }
 
-        if (raytraceresult != null && raytraceresult.field_72313_a != RayTraceResult.Type.MISS)
+        if (raytraceresult != null && raytraceresult.typeOfHit != RayTraceResult.Type.MISS)
         {
-            if (raytraceresult.field_72313_a == RayTraceResult.Type.ENTITY)
+            if (raytraceresult.typeOfHit == RayTraceResult.Type.ENTITY)
             {
-                this.field_146043_c = raytraceresult.field_72308_g;
-                this.func_190622_s();
+                this.caughtEntity = raytraceresult.entityHit;
+                this.setHookedEntity();
             }
             else
             {
-                this.field_146051_au = true;
+                this.inGround = true;
             }
         }
     }
 
-    private void func_190622_s()
+    private void setHookedEntity()
     {
-        this.func_184212_Q().func_187227_b(field_184528_c, Integer.valueOf(this.field_146043_c.func_145782_y() + 1));
+        this.getDataManager().set(DATA_HOOKED_ENTITY, Integer.valueOf(this.caughtEntity.getEntityId() + 1));
     }
 
-    private void func_190621_a(BlockPos p_190621_1_)
+    private void catchingFish(BlockPos p_190621_1_)
     {
-        WorldServer worldserver = (WorldServer)this.field_70170_p;
+        WorldServer worldserver = (WorldServer)this.world;
         int i = 1;
-        BlockPos blockpos = p_190621_1_.func_177984_a();
+        BlockPos blockpos = p_190621_1_.up();
 
-        if (this.field_70146_Z.nextFloat() < 0.25F && this.field_70170_p.func_175727_C(blockpos))
+        if (this.rand.nextFloat() < 0.25F && this.world.isRainingAt(blockpos))
         {
             ++i;
         }
 
-        if (this.field_70146_Z.nextFloat() < 0.5F && !this.field_70170_p.func_175678_i(blockpos))
+        if (this.rand.nextFloat() < 0.5F && !this.world.canSeeSky(blockpos))
         {
             --i;
         }
 
-        if (this.field_146045_ax > 0)
+        if (this.ticksCatchable > 0)
         {
-            --this.field_146045_ax;
+            --this.ticksCatchable;
 
-            if (this.field_146045_ax <= 0)
+            if (this.ticksCatchable <= 0)
             {
-                this.field_146040_ay = 0;
-                this.field_146038_az = 0;
+                this.ticksCaughtDelay = 0;
+                this.ticksCatchableDelay = 0;
+                // CraftBukkit start
+                PlayerFishEvent playerFishEvent = new PlayerFishEvent((Player) this.angler.getBukkitEntity(), null, (Fish) this.getBukkitEntity(), PlayerFishEvent.State.FAILED_ATTEMPT);
+                this.world.getServer().getPluginManager().callEvent(playerFishEvent);
+                // CraftBukkit end
             }
             else
             {
-                this.field_70181_x -= 0.2D * (double)this.field_70146_Z.nextFloat() * (double)this.field_70146_Z.nextFloat();
+                this.motionY -= 0.2D * (double)this.rand.nextFloat() * (double)this.rand.nextFloat();
             }
         }
-        else if (this.field_146038_az > 0)
+        else if (this.ticksCatchableDelay > 0)
         {
-            this.field_146038_az -= i;
+            this.ticksCatchableDelay -= i;
 
-            if (this.field_146038_az > 0)
+            if (this.ticksCatchableDelay > 0)
             {
-                this.field_146054_aA = (float)((double)this.field_146054_aA + this.field_70146_Z.nextGaussian() * 4.0D);
-                float f = this.field_146054_aA * 0.017453292F;
-                float f1 = MathHelper.func_76126_a(f);
-                float f2 = MathHelper.func_76134_b(f);
-                double d0 = this.field_70165_t + (double)(f1 * (float)this.field_146038_az * 0.1F);
-                double d1 = (double)((float)MathHelper.func_76128_c(this.func_174813_aQ().field_72338_b) + 1.0F);
-                double d2 = this.field_70161_v + (double)(f2 * (float)this.field_146038_az * 0.1F);
-                Block block = worldserver.func_180495_p(new BlockPos(d0, d1 - 1.0D, d2)).func_177230_c();
+                this.fishApproachAngle = (float)((double)this.fishApproachAngle + this.rand.nextGaussian() * 4.0D);
+                float f = this.fishApproachAngle * 0.017453292F;
+                float f1 = MathHelper.sin(f);
+                float f2 = MathHelper.cos(f);
+                double d0 = this.posX + (double)(f1 * (float)this.ticksCatchableDelay * 0.1F);
+                double d1 = (double)((float)MathHelper.floor(this.getEntityBoundingBox().minY) + 1.0F);
+                double d2 = this.posZ + (double)(f2 * (float)this.ticksCatchableDelay * 0.1F);
+                Block block = worldserver.getBlockState(new BlockPos(d0, d1 - 1.0D, d2)).getBlock();
 
-                if (block == Blocks.field_150355_j || block == Blocks.field_150358_i)
+                if (block == Blocks.WATER || block == Blocks.FLOWING_WATER)
                 {
-                    if (this.field_70146_Z.nextFloat() < 0.15F)
+                    if (this.rand.nextFloat() < 0.15F)
                     {
-                        worldserver.func_175739_a(EnumParticleTypes.WATER_BUBBLE, d0, d1 - 0.10000000149011612D, d2, 1, (double)f1, 0.1D, (double)f2, 0.0D, new int[0]);
+                        worldserver.spawnParticle(EnumParticleTypes.WATER_BUBBLE, d0, d1 - 0.10000000149011612D, d2, 1, (double)f1, 0.1D, (double)f2, 0.0D, new int[0]);
                     }
 
                     float f3 = f1 * 0.04F;
                     float f4 = f2 * 0.04F;
-                    worldserver.func_175739_a(EnumParticleTypes.WATER_WAKE, d0, d1, d2, 0, (double)f4, 0.01D, (double)(-f3), 1.0D, new int[0]);
-                    worldserver.func_175739_a(EnumParticleTypes.WATER_WAKE, d0, d1, d2, 0, (double)(-f4), 0.01D, (double)f3, 1.0D, new int[0]);
+                    worldserver.spawnParticle(EnumParticleTypes.WATER_WAKE, d0, d1, d2, 0, (double)f4, 0.01D, (double)(-f3), 1.0D, new int[0]);
+                    worldserver.spawnParticle(EnumParticleTypes.WATER_WAKE, d0, d1, d2, 0, (double)(-f4), 0.01D, (double)f3, 1.0D, new int[0]);
                 }
             }
             else
             {
-                this.field_70181_x = (double)(-0.4F * MathHelper.func_151240_a(this.field_70146_Z, 0.6F, 1.0F));
-                this.func_184185_a(SoundEvents.field_187609_F, 0.25F, 1.0F + (this.field_70146_Z.nextFloat() - this.field_70146_Z.nextFloat()) * 0.4F);
-                double d3 = this.func_174813_aQ().field_72338_b + 0.5D;
-                worldserver.func_175739_a(EnumParticleTypes.WATER_BUBBLE, this.field_70165_t, d3, this.field_70161_v, (int)(1.0F + this.field_70130_N * 20.0F), (double)this.field_70130_N, 0.0D, (double)this.field_70130_N, 0.20000000298023224D, new int[0]);
-                worldserver.func_175739_a(EnumParticleTypes.WATER_WAKE, this.field_70165_t, d3, this.field_70161_v, (int)(1.0F + this.field_70130_N * 20.0F), (double)this.field_70130_N, 0.0D, (double)this.field_70130_N, 0.20000000298023224D, new int[0]);
-                this.field_146045_ax = MathHelper.func_76136_a(this.field_70146_Z, 20, 40);
+                // CraftBukkit start
+                PlayerFishEvent playerFishEvent = new PlayerFishEvent((Player) this.angler.getBukkitEntity(), null, (Fish) this.getBukkitEntity(), PlayerFishEvent.State.BITE);
+                this.world.getServer().getPluginManager().callEvent(playerFishEvent);
+                if (playerFishEvent.isCancelled()) {
+                    return;
+                }
+                // CraftBukkit end
+                this.motionY = (double)(-0.4F * MathHelper.nextFloat(this.rand, 0.6F, 1.0F));
+                this.playSound(SoundEvents.ENTITY_BOBBER_SPLASH, 0.25F, 1.0F + (this.rand.nextFloat() - this.rand.nextFloat()) * 0.4F);
+                double d3 = this.getEntityBoundingBox().minY + 0.5D;
+                worldserver.spawnParticle(EnumParticleTypes.WATER_BUBBLE, this.posX, d3, this.posZ, (int)(1.0F + this.width * 20.0F), (double)this.width, 0.0D, (double)this.width, 0.20000000298023224D, new int[0]);
+                worldserver.spawnParticle(EnumParticleTypes.WATER_WAKE, this.posX, d3, this.posZ, (int)(1.0F + this.width * 20.0F), (double)this.width, 0.0D, (double)this.width, 0.20000000298023224D, new int[0]);
+                this.ticksCatchable = MathHelper.getInt(this.rand, 20, 40);
             }
         }
-        else if (this.field_146040_ay > 0)
+        else if (this.ticksCaughtDelay > 0)
         {
-            this.field_146040_ay -= i;
+            this.ticksCaughtDelay -= i;
             float f5 = 0.15F;
 
-            if (this.field_146040_ay < 20)
+            if (this.ticksCaughtDelay < 20)
             {
-                f5 = (float)((double)f5 + (double)(20 - this.field_146040_ay) * 0.05D);
+                f5 = (float)((double)f5 + (double)(20 - this.ticksCaughtDelay) * 0.05D);
             }
-            else if (this.field_146040_ay < 40)
+            else if (this.ticksCaughtDelay < 40)
             {
-                f5 = (float)((double)f5 + (double)(40 - this.field_146040_ay) * 0.02D);
+                f5 = (float)((double)f5 + (double)(40 - this.ticksCaughtDelay) * 0.02D);
             }
-            else if (this.field_146040_ay < 60)
+            else if (this.ticksCaughtDelay < 60)
             {
-                f5 = (float)((double)f5 + (double)(60 - this.field_146040_ay) * 0.01D);
+                f5 = (float)((double)f5 + (double)(60 - this.ticksCaughtDelay) * 0.01D);
             }
 
-            if (this.field_70146_Z.nextFloat() < f5)
+            if (this.rand.nextFloat() < f5)
             {
-                float f6 = MathHelper.func_151240_a(this.field_70146_Z, 0.0F, 360.0F) * 0.017453292F;
-                float f7 = MathHelper.func_151240_a(this.field_70146_Z, 25.0F, 60.0F);
-                double d4 = this.field_70165_t + (double)(MathHelper.func_76126_a(f6) * f7 * 0.1F);
-                double d5 = (double)((float)MathHelper.func_76128_c(this.func_174813_aQ().field_72338_b) + 1.0F);
-                double d6 = this.field_70161_v + (double)(MathHelper.func_76134_b(f6) * f7 * 0.1F);
-                Block block1 = worldserver.func_180495_p(new BlockPos((int)d4, (int)d5 - 1, (int)d6)).func_177230_c();
+                float f6 = MathHelper.nextFloat(this.rand, 0.0F, 360.0F) * 0.017453292F;
+                float f7 = MathHelper.nextFloat(this.rand, 25.0F, 60.0F);
+                double d4 = this.posX + (double)(MathHelper.sin(f6) * f7 * 0.1F);
+                double d5 = (double)((float)MathHelper.floor(this.getEntityBoundingBox().minY) + 1.0F);
+                double d6 = this.posZ + (double)(MathHelper.cos(f6) * f7 * 0.1F);
+                Block block1 = worldserver.getBlockState(new BlockPos((int)d4, (int)d5 - 1, (int)d6)).getBlock();
 
-                if (block1 == Blocks.field_150355_j || block1 == Blocks.field_150358_i)
+                if (block1 == Blocks.WATER || block1 == Blocks.FLOWING_WATER)
                 {
-                    worldserver.func_175739_a(EnumParticleTypes.WATER_SPLASH, d4, d5, d6, 2 + this.field_70146_Z.nextInt(2), 0.10000000149011612D, 0.0D, 0.10000000149011612D, 0.0D, new int[0]);
+                    worldserver.spawnParticle(EnumParticleTypes.WATER_SPLASH, d4, d5, d6, 2 + this.rand.nextInt(2), 0.10000000149011612D, 0.0D, 0.10000000149011612D, 0.0D, new int[0]);
                 }
             }
 
-            if (this.field_146040_ay <= 0)
+            if (this.ticksCaughtDelay <= 0)
             {
-                this.field_146054_aA = MathHelper.func_151240_a(this.field_70146_Z, 0.0F, 360.0F);
-                this.field_146038_az = MathHelper.func_76136_a(this.field_70146_Z, 20, 80);
+                this.fishApproachAngle = MathHelper.nextFloat(this.rand, 0.0F, 360.0F);
+                this.ticksCatchableDelay = MathHelper.getInt(this.rand, 20, 80);
             }
         }
         else
         {
-            this.field_146040_ay = MathHelper.func_76136_a(this.field_70146_Z, 100, 600);
-            this.field_146040_ay -= this.field_191519_ax * 20 * 5;
+            this.ticksCaughtDelay = MathHelper.getInt(this.rand, 100, 600);
+            this.ticksCaughtDelay -= this.field_191519_ax * 20 * 5;
         }
     }
 
-    protected boolean func_189739_a(Entity p_189739_1_)
+    protected boolean canBeHooked(Entity p_189739_1_)
     {
-        return p_189739_1_.func_70067_L() || p_189739_1_ instanceof EntityItem;
+        return p_189739_1_.canBeCollidedWith() || p_189739_1_ instanceof EntityItem;
     }
 
-    public void func_70014_b(NBTTagCompound p_70014_1_)
+    public void writeEntityToNBT(NBTTagCompound compound)
     {
     }
 
-    public void func_70037_a(NBTTagCompound p_70037_1_)
+    public void readEntityFromNBT(NBTTagCompound compound)
     {
     }
 
-    public int func_146034_e()
+    public int handleHookRetraction()
     {
-        if (!this.field_70170_p.field_72995_K && this.field_146042_b != null)
+        if (!this.world.isRemote && this.angler != null)
         {
             int i = 0;
 
-            if (this.field_146043_c != null)
+            net.minecraftforge.event.entity.player.ItemFishedEvent event = null;
+            if (this.caughtEntity != null)
             {
-                this.func_184527_k();
-                this.field_70170_p.func_72960_a(this, (byte)31);
-                i = this.field_146043_c instanceof EntityItem ? 3 : 5;
+                // CraftBukkit start
+                PlayerFishEvent playerFishEvent = new PlayerFishEvent((Player) this.angler.getBukkitEntity(), this.caughtEntity.getBukkitEntity(), (Fish) this.getBukkitEntity(), PlayerFishEvent.State.CAUGHT_ENTITY);
+                this.world.getServer().getPluginManager().callEvent(playerFishEvent);
+
+                if (playerFishEvent.isCancelled()) {
+                    return 0;
+                }
+                // CraftBukkit end
+                this.bringInHookedEntity();
+                this.world.setEntityState(this, (byte)31);
+                i = this.caughtEntity instanceof EntityItem ? 3 : 5;
             }
-            else if (this.field_146045_ax > 0)
+            else if (this.ticksCatchable > 0)
             {
-                LootContext.Builder lootcontext$builder = new LootContext.Builder((WorldServer)this.field_70170_p);
-                lootcontext$builder.func_186469_a((float)this.field_191518_aw + this.field_146042_b.func_184817_da());
+                LootContext.Builder lootcontext$builder = new LootContext.Builder((WorldServer)this.world);
+                lootcontext$builder.withLuck((float)this.field_191518_aw + this.angler.getLuck());
+                List<ItemStack> result = this.world.getLootTableManager().getLootTableFromLocation(LootTableList.GAMEPLAY_FISHING).generateLootForPools(this.rand, lootcontext$builder.build());
+                event = new net.minecraftforge.event.entity.player.ItemFishedEvent(result, this.inGround ? 2 : 1, this);
+                net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(event);
+                if (event.isCanceled())
+                {
+                    this.setDead();
+                    return event.getRodDamage();
+                }
 
-                for (ItemStack itemstack : this.field_70170_p.func_184146_ak().func_186521_a(LootTableList.field_186387_al).func_186462_a(this.field_70146_Z, lootcontext$builder.func_186471_a()))
+                for (ItemStack itemstack : result)
                 {
-                    EntityItem entityitem = new EntityItem(this.field_70170_p, this.field_70165_t, this.field_70163_u, this.field_70161_v, itemstack);
-                    double d0 = this.field_146042_b.field_70165_t - this.field_70165_t;
-                    double d1 = this.field_146042_b.field_70163_u - this.field_70163_u;
-                    double d2 = this.field_146042_b.field_70161_v - this.field_70161_v;
-                    double d3 = (double)MathHelper.func_76133_a(d0 * d0 + d1 * d1 + d2 * d2);
+                    EntityItem entityitem = new EntityItem(this.world, this.posX, this.posY, this.posZ, itemstack);
+                    // CraftBukkit start
+                    PlayerFishEvent playerFishEvent = new PlayerFishEvent((Player) this.angler.getBukkitEntity(), entityitem.getBukkitEntity(), (Fish) this.getBukkitEntity(), PlayerFishEvent.State.CAUGHT_FISH);
+                    playerFishEvent.setExpToDrop(this.rand.nextInt(6) + 1);
+                    this.world.getServer().getPluginManager().callEvent(playerFishEvent);
+
+                    if (playerFishEvent.isCancelled()) {
+                        return 0;
+                    }
+                    // CraftBukkit end
+                    double d0 = this.angler.posX - this.posX;
+                    double d1 = this.angler.posY - this.posY;
+                    double d2 = this.angler.posZ - this.posZ;
+                    double d3 = (double)MathHelper.sqrt(d0 * d0 + d1 * d1 + d2 * d2);
                     double d4 = 0.1D;
-                    entityitem.field_70159_w = d0 * 0.1D;
-                    entityitem.field_70181_x = d1 * 0.1D + (double)MathHelper.func_76133_a(d3) * 0.08D;
-                    entityitem.field_70179_y = d2 * 0.1D;
-                    this.field_70170_p.func_72838_d(entityitem);
-                    this.field_146042_b.field_70170_p.func_72838_d(new EntityXPOrb(this.field_146042_b.field_70170_p, this.field_146042_b.field_70165_t, this.field_146042_b.field_70163_u + 0.5D, this.field_146042_b.field_70161_v + 0.5D, this.field_70146_Z.nextInt(6) + 1));
-                    Item item = itemstack.func_77973_b();
+                    entityitem.motionX = d0 * 0.1D;
+                    entityitem.motionY = d1 * 0.1D + (double)MathHelper.sqrt(d3) * 0.08D;
+                    entityitem.motionZ = d2 * 0.1D;
+                    this.world.spawnEntity(entityitem);
+                    // CraftBukkit start - this.random.nextInt(6) + 1 -> playerFishEvent.getExpToDrop()
+                    if (playerFishEvent.getExpToDrop() > 0) {
+                        this.angler.world.spawnEntity(new EntityXPOrb(this.angler.world, this.angler.posX, this.angler.posY + 0.5D, this.angler.posZ + 0.5D, playerFishEvent.getExpToDrop()));
+                    }
+                    // CraftBukkit end
+                    this.angler.world.spawnEntity(new EntityXPOrb(this.angler.world, this.angler.posX, this.angler.posY + 0.5D, this.angler.posZ + 0.5D, this.rand.nextInt(6) + 1));
+                    Item item = itemstack.getItem();
 
-                    if (item == Items.field_151115_aP || item == Items.field_179566_aV)
+                    if (item == Items.FISH || item == Items.COOKED_FISH)
                     {
-                        this.field_146042_b.func_71064_a(StatList.field_188071_E, 1);
+                        this.angler.addStat(StatList.FISH_CAUGHT, 1);
                     }
                 }
 
                 i = 1;
             }
 
-            if (this.field_146051_au)
+            if (this.inGround)
             {
+                // CraftBukkit start
+                PlayerFishEvent playerFishEvent = new PlayerFishEvent((Player) this.angler.getBukkitEntity(), null, (Fish) this.getBukkitEntity(), PlayerFishEvent.State.IN_GROUND);
+                this.world.getServer().getPluginManager().callEvent(playerFishEvent);
+
+                if (playerFishEvent.isCancelled()) {
+                    return 0;
+                }
+                // CraftBukkit end
                 i = 2;
             }
+            // CraftBukkit start
+            if (i == 0) {
+                PlayerFishEvent playerFishEvent = new PlayerFishEvent((Player) this.angler.getBukkitEntity(), null, (Fish) this.getBukkitEntity(), PlayerFishEvent.State.FAILED_ATTEMPT);
+                this.world.getServer().getPluginManager().callEvent(playerFishEvent);
+                if (playerFishEvent.isCancelled()) {
+                    return 0;
+                }
+            }
+            // CraftBukkit end
 
-            this.func_70106_y();
-            return i;
+            this.setDead();
+            return event == null ? i : event.getRodDamage();
         }
         else
         {
@@ -556,48 +618,48 @@
     }
 
     @SideOnly(Side.CLIENT)
-    public void func_70103_a(byte p_70103_1_)
+    public void handleStatusUpdate(byte id)
     {
-        if (p_70103_1_ == 31 && this.field_70170_p.field_72995_K && this.field_146043_c instanceof EntityPlayer && ((EntityPlayer)this.field_146043_c).func_175144_cb())
+        if (id == 31 && this.world.isRemote && this.caughtEntity instanceof EntityPlayer && ((EntityPlayer)this.caughtEntity).isUser())
         {
-            this.func_184527_k();
+            this.bringInHookedEntity();
         }
 
-        super.func_70103_a(p_70103_1_);
+        super.handleStatusUpdate(id);
     }
 
-    protected void func_184527_k()
+    protected void bringInHookedEntity()
     {
-        if (this.field_146042_b != null)
+        if (this.angler != null)
         {
-            double d0 = this.field_146042_b.field_70165_t - this.field_70165_t;
-            double d1 = this.field_146042_b.field_70163_u - this.field_70163_u;
-            double d2 = this.field_146042_b.field_70161_v - this.field_70161_v;
+            double d0 = this.angler.posX - this.posX;
+            double d1 = this.angler.posY - this.posY;
+            double d2 = this.angler.posZ - this.posZ;
             double d3 = 0.1D;
-            this.field_146043_c.field_70159_w += d0 * 0.1D;
-            this.field_146043_c.field_70181_x += d1 * 0.1D;
-            this.field_146043_c.field_70179_y += d2 * 0.1D;
+            this.caughtEntity.motionX += d0 * 0.1D;
+            this.caughtEntity.motionY += d1 * 0.1D;
+            this.caughtEntity.motionZ += d2 * 0.1D;
         }
     }
 
-    protected boolean func_70041_e_()
+    protected boolean canTriggerWalking()
     {
         return false;
     }
 
-    public void func_70106_y()
+    public void setDead()
     {
-        super.func_70106_y();
+        super.setDead();
 
-        if (this.field_146042_b != null)
+        if (this.angler != null)
         {
-            this.field_146042_b.field_71104_cf = null;
+            this.angler.fishEntity = null;
         }
     }
 
-    public EntityPlayer func_190619_l()
+    public EntityPlayer getAngler()
     {
-        return this.field_146042_b;
+        return this.angler;
     }
 
     static enum State
