--- ../src-base/minecraft/net/minecraft/entity/EntityHanging.java
+++ ../src-work/minecraft/net/minecraft/entity/EntityHanging.java
@@ -3,6 +3,7 @@
 import com.google.common.base.Predicate;
 import javax.annotation.Nullable;
 import net.minecraft.block.BlockRedstoneDiode;
+import net.minecraft.block.material.Material;
 import net.minecraft.block.state.IBlockState;
 import net.minecraft.entity.effect.EntityLightningBolt;
 import net.minecraft.entity.item.EntityItem;
@@ -18,121 +19,148 @@
 import net.minecraft.util.math.MathHelper;
 import net.minecraft.world.World;
 import org.apache.commons.lang3.Validate;
+import org.bukkit.entity.Hanging;
+import org.bukkit.event.hanging.HangingBreakByEntityEvent;
+import org.bukkit.event.hanging.HangingBreakEvent;
 
 public abstract class EntityHanging extends Entity
 {
-    private static final Predicate<Entity> field_184524_c = new Predicate<Entity>()
+    private static final Predicate<Entity> IS_HANGING_ENTITY = new Predicate<Entity>()
     {
         public boolean apply(@Nullable Entity p_apply_1_)
         {
             return p_apply_1_ instanceof EntityHanging;
         }
     };
-    private int field_70520_f;
-    public BlockPos field_174861_a;
+    private int tickCounter1;
+    public BlockPos hangingPosition;
     @Nullable
-    public EnumFacing field_174860_b;
+    public EnumFacing facingDirection;
 
-    public EntityHanging(World p_i1588_1_)
+    public EntityHanging(World worldIn)
     {
-        super(p_i1588_1_);
-        this.func_70105_a(0.5F, 0.5F);
+        super(worldIn);
+        this.setSize(0.5F, 0.5F);
     }
 
-    public EntityHanging(World p_i45853_1_, BlockPos p_i45853_2_)
+    public EntityHanging(World worldIn, BlockPos hangingPositionIn)
     {
-        this(p_i45853_1_);
-        this.field_174861_a = p_i45853_2_;
+        this(worldIn);
+        this.hangingPosition = hangingPositionIn;
     }
 
-    protected void func_70088_a()
+    protected void entityInit()
     {
     }
 
-    public void func_174859_a(EnumFacing p_174859_1_)
+    public void updateFacingWithBoundingBox(EnumFacing facingDirectionIn)
     {
-        Validate.notNull(p_174859_1_);
-        Validate.isTrue(p_174859_1_.func_176740_k().func_176722_c());
-        this.field_174860_b = p_174859_1_;
-        this.field_70177_z = (float)(this.field_174860_b.func_176736_b() * 90);
-        this.field_70126_B = this.field_70177_z;
-        this.func_174856_o();
+        Validate.notNull(facingDirectionIn);
+        Validate.isTrue(facingDirectionIn.getAxis().isHorizontal());
+        this.facingDirection = facingDirectionIn;
+        this.rotationYaw = (float)(this.facingDirection.getHorizontalIndex() * 90);
+        this.prevRotationYaw = this.rotationYaw;
+        this.updateBoundingBox();
     }
 
-    protected void func_174856_o()
-    {
-        if (this.field_174860_b != null)
-        {
-            double d0 = (double)this.field_174861_a.func_177958_n() + 0.5D;
-            double d1 = (double)this.field_174861_a.func_177956_o() + 0.5D;
-            double d2 = (double)this.field_174861_a.func_177952_p() + 0.5D;
-            double d3 = 0.46875D;
-            double d4 = this.func_190202_a(this.func_82329_d());
-            double d5 = this.func_190202_a(this.func_82330_g());
-            d0 = d0 - (double)this.field_174860_b.func_82601_c() * 0.46875D;
-            d2 = d2 - (double)this.field_174860_b.func_82599_e() * 0.46875D;
-            d1 = d1 + d5;
-            EnumFacing enumfacing = this.field_174860_b.func_176735_f();
-            d0 = d0 + d4 * (double)enumfacing.func_82601_c();
-            d2 = d2 + d4 * (double)enumfacing.func_82599_e();
-            this.field_70165_t = d0;
-            this.field_70163_u = d1;
-            this.field_70161_v = d2;
-            double d6 = (double)this.func_82329_d();
-            double d7 = (double)this.func_82330_g();
-            double d8 = (double)this.func_82329_d();
+    // CraftBukkit start - break out BB calc into own method
+    public static AxisAlignedBB calculateBoundingBox(net.minecraft.entity.Entity entity, BlockPos blockPosition, EnumFacing direction, int width, int height) {
+        double d0 = (double) blockPosition.getX() + 0.5D;
+        double d1 = (double) blockPosition.getY() + 0.5D;
+        double d2 = (double) blockPosition.getZ() + 0.5D;
+        double d3 = 0.46875D;
+        double d4 = offs(width);
+        double d5 = offs(height);
 
-            if (this.field_174860_b.func_176740_k() == EnumFacing.Axis.Z)
-            {
-                d8 = 1.0D;
-            }
-            else
-            {
-                d6 = 1.0D;
-            }
+        d0 -= (double) direction.getFrontOffsetX() * 0.46875D;
+        d2 -= (double) direction.getFrontOffsetZ() * 0.46875D;
+        d1 += d5;
+        EnumFacing enumdirection = direction.rotateYCCW();
 
-            d6 = d6 / 32.0D;
-            d7 = d7 / 32.0D;
-            d8 = d8 / 32.0D;
-            this.func_174826_a(new AxisAlignedBB(d0 - d6, d1 - d7, d2 - d8, d0 + d6, d1 + d7, d2 + d8));
+        d0 += d4 * (double) enumdirection.getFrontOffsetX();
+        d2 += d4 * (double) enumdirection.getFrontOffsetZ();
+        if (entity != null) {
+            entity.posX = d0;
+            entity.posY = d1;
+            entity.posZ = d2;
         }
+        double d6 = (double) width;
+        double d7 = (double) height;
+        double d8 = (double) width;
+
+        if (direction.getAxis() == EnumFacing.Axis.Z) {
+            d8 = 1.0D;
+        } else {
+            d6 = 1.0D;
+        }
+
+        d6 /= 32.0D;
+        d7 /= 32.0D;
+        d8 /= 32.0D;
+        return new AxisAlignedBB(d0 - d6, d1 - d7, d2 - d8, d0 + d6, d1 + d7, d2 + d8);
     }
 
-    private double func_190202_a(int p_190202_1_)
+    protected void updateBoundingBox() {
+        if (this.facingDirection != null) {
+            // CraftBukkit start code moved in to calculateBoundingBox
+            this.setEntityBoundingBox(calculateBoundingBox(this, this.hangingPosition, this.facingDirection, this.getWidthPixels(), this.getHeightPixels()));
+            // CraftBukkit end
+        }
+    }
+
+    private static double offs(int p_190202_1_)
     {
         return p_190202_1_ % 32 == 0 ? 0.5D : 0.0D;
     }
 
-    public void func_70071_h_()
+    public void onUpdate()
     {
-        this.field_70169_q = this.field_70165_t;
-        this.field_70167_r = this.field_70163_u;
-        this.field_70166_s = this.field_70161_v;
+        this.prevPosX = this.posX;
+        this.prevPosY = this.posY;
+        this.prevPosZ = this.posZ;
 
-        if (this.field_70520_f++ == 100 && !this.field_70170_p.field_72995_K)
+        if (this.tickCounter1++ == 100 && !this.world.isRemote)
         {
-            this.field_70520_f = 0;
+            this.tickCounter1 = 0;
 
-            if (!this.field_70128_L && !this.func_70518_d())
+            if (!this.isDead && !this.onValidSurface())
             {
-                this.func_70106_y();
-                this.func_110128_b((Entity)null);
+                // CraftBukkit start - fire break events
+                Material material = this.world.getBlockState(new BlockPos(this)).getMaterial();
+                HangingBreakEvent.RemoveCause cause;
+
+                if (!material.equals(Material.AIR)) {
+                    // TODO: This feels insufficient to catch 100% of suffocation cases
+                    cause = HangingBreakEvent.RemoveCause.OBSTRUCTION;
+                } else {
+                    cause = HangingBreakEvent.RemoveCause.PHYSICS;
+                }
+
+                HangingBreakEvent event = new HangingBreakEvent((Hanging) this.getBukkitEntity(), cause);
+                this.world.getServer().getPluginManager().callEvent(event);
+
+                if (isDead || event.isCancelled()) {
+                    return;
+                }
+                // CraftBukkit end
+                this.setDead();
+                this.onBroken((Entity)null);
             }
         }
     }
 
-    public boolean func_70518_d()
+    public boolean onValidSurface()
     {
-        if (!this.field_70170_p.func_184144_a(this, this.func_174813_aQ()).isEmpty())
+        if (!this.world.getCollisionBoxes(this, this.getEntityBoundingBox()).isEmpty())
         {
             return false;
         }
         else
         {
-            int i = Math.max(1, this.func_82329_d() / 16);
-            int j = Math.max(1, this.func_82330_g() / 16);
-            BlockPos blockpos = this.field_174861_a.func_177972_a(this.field_174860_b.func_176734_d());
-            EnumFacing enumfacing = this.field_174860_b.func_176735_f();
+            int i = Math.max(1, this.getWidthPixels() / 16);
+            int j = Math.max(1, this.getHeightPixels() / 16);
+            BlockPos blockpos = this.hangingPosition.offset(this.facingDirection.getOpposite());
+            EnumFacing enumfacing = this.facingDirection.rotateYCCW();
             BlockPos.MutableBlockPos blockpos$mutableblockpos = new BlockPos.MutableBlockPos();
 
             for (int k = 0; k < i; ++k)
@@ -141,141 +169,167 @@
                 {
                     int i1 = (i - 1) / -2;
                     int j1 = (j - 1) / -2;
-                    blockpos$mutableblockpos.func_189533_g(blockpos).func_189534_c(enumfacing, k + i1).func_189534_c(EnumFacing.UP, l + j1);
-                    IBlockState iblockstate = this.field_70170_p.func_180495_p(blockpos$mutableblockpos);
+                    blockpos$mutableblockpos.setPos(blockpos).move(enumfacing, k + i1).move(EnumFacing.UP, l + j1);
+                    IBlockState iblockstate = this.world.getBlockState(blockpos$mutableblockpos);
 
-                    if (!iblockstate.func_185904_a().func_76220_a() && !BlockRedstoneDiode.func_185546_B(iblockstate))
+                    if (iblockstate.isSideSolid(this.world, blockpos$mutableblockpos, this.facingDirection))
+                        continue;
+
+                    if (!iblockstate.getMaterial().isSolid() && !BlockRedstoneDiode.isDiode(iblockstate))
                     {
                         return false;
                     }
                 }
             }
 
-            return this.field_70170_p.func_175674_a(this, this.func_174813_aQ(), field_184524_c).isEmpty();
+            return this.world.getEntitiesInAABBexcluding(this, this.getEntityBoundingBox(), IS_HANGING_ENTITY).isEmpty();
         }
     }
 
-    public boolean func_70067_L()
+    public boolean canBeCollidedWith()
     {
         return true;
     }
 
-    public boolean func_85031_j(Entity p_85031_1_)
+    public boolean hitByEntity(Entity entityIn)
     {
-        return p_85031_1_ instanceof EntityPlayer ? this.func_70097_a(DamageSource.func_76365_a((EntityPlayer)p_85031_1_), 0.0F) : false;
+        return entityIn instanceof EntityPlayer ? this.attackEntityFrom(DamageSource.causePlayerDamage((EntityPlayer)entityIn), 0.0F) : false;
     }
 
-    public EnumFacing func_174811_aO()
+    public EnumFacing getHorizontalFacing()
     {
-        return this.field_174860_b;
+        return this.facingDirection;
     }
 
-    public boolean func_70097_a(DamageSource p_70097_1_, float p_70097_2_)
+    public boolean attackEntityFrom(DamageSource source, float amount)
     {
-        if (this.func_180431_b(p_70097_1_))
+        if (this.isEntityInvulnerable(source))
         {
             return false;
         }
         else
         {
-            if (!this.field_70128_L && !this.field_70170_p.field_72995_K)
+            if (!this.isDead && !this.world.isRemote)
             {
-                this.func_70106_y();
-                this.func_70018_K();
-                this.func_110128_b(p_70097_1_.func_76346_g());
+                // CraftBukkit start - fire break events
+                HangingBreakEvent event = new HangingBreakEvent((Hanging) this.getBukkitEntity(), HangingBreakEvent.RemoveCause.DEFAULT);
+                if (source.getEntity() != null) {
+                    event = new HangingBreakByEntityEvent((Hanging) this.getBukkitEntity(), source.getEntity() == null ? null : source.getEntity().getBukkitEntity(), source.isExplosion() ? HangingBreakEvent.RemoveCause.EXPLOSION : HangingBreakEvent.RemoveCause.ENTITY);
+                } else if (source.isExplosion()) {
+                    event = new HangingBreakEvent((Hanging) this.getBukkitEntity(), HangingBreakEvent.RemoveCause.EXPLOSION);
+                }
+
+                this.world.getServer().getPluginManager().callEvent(event);
+
+                if (this.isDead || event.isCancelled()) {
+                    return true;
+                }
+                // CraftBukkit end
+                this.setDead();
+                this.setBeenAttacked();
+                this.onBroken(source.getEntity());
             }
 
             return true;
         }
     }
 
-    public void func_70091_d(MoverType p_70091_1_, double p_70091_2_, double p_70091_4_, double p_70091_6_)
+    public void move(MoverType type, double x, double y, double z)
     {
-        if (!this.field_70170_p.field_72995_K && !this.field_70128_L && p_70091_2_ * p_70091_2_ + p_70091_4_ * p_70091_4_ + p_70091_6_ * p_70091_6_ > 0.0D)
+        if (!this.world.isRemote && !this.isDead && x * x + y * y + z * z > 0.0D)
         {
-            this.func_70106_y();
-            this.func_110128_b((Entity)null);
+            // CraftBukkit start - fire break events
+            // TODO - Does this need its own cause? Seems to only be triggered by pistons
+            HangingBreakEvent event = new HangingBreakEvent((Hanging) this.getBukkitEntity(), HangingBreakEvent.RemoveCause.PHYSICS);
+            this.world.getServer().getPluginManager().callEvent(event);
+
+            if (this.isDead || event.isCancelled()) {
+                return;
+            }
+            // CraftBukkit end
+            this.setDead();
+            this.onBroken((Entity)null);
         }
     }
 
-    public void func_70024_g(double p_70024_1_, double p_70024_3_, double p_70024_5_)
+    public void addVelocity(double x, double y, double z)
     {
-        if (!this.field_70170_p.field_72995_K && !this.field_70128_L && p_70024_1_ * p_70024_1_ + p_70024_3_ * p_70024_3_ + p_70024_5_ * p_70024_5_ > 0.0D)
+        if (!this.world.isRemote && !this.isDead && x * x + y * y + z * z > 0.0D)
         {
-            this.func_70106_y();
-            this.func_110128_b((Entity)null);
+            this.setDead();
+            this.onBroken((Entity)null);
         }
     }
 
-    public void func_70014_b(NBTTagCompound p_70014_1_)
+    public void writeEntityToNBT(NBTTagCompound compound)
     {
-        p_70014_1_.func_74774_a("Facing", (byte)this.field_174860_b.func_176736_b());
-        BlockPos blockpos = this.func_174857_n();
-        p_70014_1_.func_74768_a("TileX", blockpos.func_177958_n());
-        p_70014_1_.func_74768_a("TileY", blockpos.func_177956_o());
-        p_70014_1_.func_74768_a("TileZ", blockpos.func_177952_p());
+        compound.setByte("Facing", (byte)this.facingDirection.getHorizontalIndex());
+        BlockPos blockpos = this.getHangingPosition();
+        compound.setInteger("TileX", blockpos.getX());
+        compound.setInteger("TileY", blockpos.getY());
+        compound.setInteger("TileZ", blockpos.getZ());
     }
 
-    public void func_70037_a(NBTTagCompound p_70037_1_)
+    public void readEntityFromNBT(NBTTagCompound compound)
     {
-        this.field_174861_a = new BlockPos(p_70037_1_.func_74762_e("TileX"), p_70037_1_.func_74762_e("TileY"), p_70037_1_.func_74762_e("TileZ"));
-        this.func_174859_a(EnumFacing.func_176731_b(p_70037_1_.func_74771_c("Facing")));
+        this.hangingPosition = new BlockPos(compound.getInteger("TileX"), compound.getInteger("TileY"), compound.getInteger("TileZ"));
+        this.updateFacingWithBoundingBox(EnumFacing.getHorizontal(compound.getByte("Facing")));
     }
 
-    public abstract int func_82329_d();
+    public abstract int getWidthPixels();
 
-    public abstract int func_82330_g();
+    public abstract int getHeightPixels();
 
-    public abstract void func_110128_b(@Nullable Entity p_110128_1_);
+    public abstract void onBroken(@Nullable Entity brokenEntity);
 
-    public abstract void func_184523_o();
+    public abstract void playPlaceSound();
 
-    public EntityItem func_70099_a(ItemStack p_70099_1_, float p_70099_2_)
+    public EntityItem entityDropItem(ItemStack stack, float offsetY)
     {
-        EntityItem entityitem = new EntityItem(this.field_70170_p, this.field_70165_t + (double)((float)this.field_174860_b.func_82601_c() * 0.15F), this.field_70163_u + (double)p_70099_2_, this.field_70161_v + (double)((float)this.field_174860_b.func_82599_e() * 0.15F), p_70099_1_);
-        entityitem.func_174869_p();
-        this.field_70170_p.func_72838_d(entityitem);
+        EntityItem entityitem = new EntityItem(this.world, this.posX + (double)((float)this.facingDirection.getFrontOffsetX() * 0.15F), this.posY + (double)offsetY, this.posZ + (double)((float)this.facingDirection.getFrontOffsetZ() * 0.15F), stack);
+        entityitem.setDefaultPickupDelay();
+        this.world.spawnEntity(entityitem);
         return entityitem;
     }
 
-    protected boolean func_142008_O()
+    protected boolean shouldSetPosAfterLoading()
     {
         return false;
     }
 
-    public void func_70107_b(double p_70107_1_, double p_70107_3_, double p_70107_5_)
+    public void setPosition(double x, double y, double z)
     {
-        this.field_174861_a = new BlockPos(p_70107_1_, p_70107_3_, p_70107_5_);
-        this.func_174856_o();
-        this.field_70160_al = true;
+        this.hangingPosition = new BlockPos(x, y, z);
+        this.updateBoundingBox();
+        this.isAirBorne = true;
     }
 
-    public BlockPos func_174857_n()
+    public BlockPos getHangingPosition()
     {
-        return this.field_174861_a;
+        return this.hangingPosition;
     }
 
     @SuppressWarnings("incomplete-switch")
-    public float func_184229_a(Rotation p_184229_1_)
+    public float getRotatedYaw(Rotation transformRotation)
     {
-        if (this.field_174860_b != null && this.field_174860_b.func_176740_k() != EnumFacing.Axis.Y)
+        if (this.facingDirection != null && this.facingDirection.getAxis() != EnumFacing.Axis.Y)
         {
-            switch (p_184229_1_)
+            switch (transformRotation)
             {
                 case CLOCKWISE_180:
-                    this.field_174860_b = this.field_174860_b.func_176734_d();
+                    this.facingDirection = this.facingDirection.getOpposite();
                     break;
                 case COUNTERCLOCKWISE_90:
-                    this.field_174860_b = this.field_174860_b.func_176735_f();
+                    this.facingDirection = this.facingDirection.rotateYCCW();
                     break;
                 case CLOCKWISE_90:
-                    this.field_174860_b = this.field_174860_b.func_176746_e();
+                    this.facingDirection = this.facingDirection.rotateY();
             }
         }
 
-        float f = MathHelper.func_76142_g(this.field_70177_z);
+        float f = MathHelper.wrapDegrees(this.rotationYaw);
 
-        switch (p_184229_1_)
+        switch (transformRotation)
         {
             case CLOCKWISE_180:
                 return f + 180.0F;
@@ -288,12 +342,12 @@
         }
     }
 
-    public float func_184217_a(Mirror p_184217_1_)
+    public float getMirroredYaw(Mirror transformMirror)
     {
-        return this.func_184229_a(p_184217_1_.func_185800_a(this.field_174860_b));
+        return this.getRotatedYaw(transformMirror.toRotation(this.facingDirection));
     }
 
-    public void func_70077_a(EntityLightningBolt p_70077_1_)
+    public void onStruckByLightning(EntityLightningBolt lightningBolt)
     {
     }
 }
