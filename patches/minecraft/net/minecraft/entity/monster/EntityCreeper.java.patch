--- ../src-base/minecraft/net/minecraft/entity/monster/EntityCreeper.java
+++ ../src-work/minecraft/net/minecraft/entity/monster/EntityCreeper.java
@@ -36,283 +36,293 @@
 import net.minecraft.world.storage.loot.LootTableList;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
+import org.bukkit.craftbukkit.event.CraftEventFactory;
 
 public class EntityCreeper extends EntityMob
 {
-    private static final DataParameter<Integer> field_184713_a = EntityDataManager.<Integer>func_187226_a(EntityCreeper.class, DataSerializers.field_187192_b);
-    private static final DataParameter<Boolean> field_184714_b = EntityDataManager.<Boolean>func_187226_a(EntityCreeper.class, DataSerializers.field_187198_h);
-    private static final DataParameter<Boolean> field_184715_c = EntityDataManager.<Boolean>func_187226_a(EntityCreeper.class, DataSerializers.field_187198_h);
-    private int field_70834_e;
-    private int field_70833_d;
-    private int field_82225_f = 30;
-    private int field_82226_g = 3;
-    private int field_175494_bm;
+    private static final DataParameter<Integer> STATE = EntityDataManager.<Integer>createKey(EntityCreeper.class, DataSerializers.VARINT);
+    private static final DataParameter<Boolean> POWERED = EntityDataManager.<Boolean>createKey(EntityCreeper.class, DataSerializers.BOOLEAN);
+    private static final DataParameter<Boolean> IGNITED = EntityDataManager.<Boolean>createKey(EntityCreeper.class, DataSerializers.BOOLEAN);
+    private int lastActiveTime;
+    private int timeSinceIgnited;
+    private int fuseTime = 30;
+    private int explosionRadius = 3;
+    private int droppedSkulls;
 
-    public EntityCreeper(World p_i1733_1_)
+    public EntityCreeper(World worldIn)
     {
-        super(p_i1733_1_);
-        this.func_70105_a(0.6F, 1.7F);
+        super(worldIn);
+        this.setSize(0.6F, 1.7F);
     }
 
-    protected void func_184651_r()
+    protected void initEntityAI()
     {
-        this.field_70714_bg.func_75776_a(1, new EntityAISwimming(this));
-        this.field_70714_bg.func_75776_a(2, new EntityAICreeperSwell(this));
-        this.field_70714_bg.func_75776_a(3, new EntityAIAvoidEntity(this, EntityOcelot.class, 6.0F, 1.0D, 1.2D));
-        this.field_70714_bg.func_75776_a(4, new EntityAIAttackMelee(this, 1.0D, false));
-        this.field_70714_bg.func_75776_a(5, new EntityAIWanderAvoidWater(this, 0.8D));
-        this.field_70714_bg.func_75776_a(6, new EntityAIWatchClosest(this, EntityPlayer.class, 8.0F));
-        this.field_70714_bg.func_75776_a(6, new EntityAILookIdle(this));
-        this.field_70715_bh.func_75776_a(1, new EntityAINearestAttackableTarget(this, EntityPlayer.class, true));
-        this.field_70715_bh.func_75776_a(2, new EntityAIHurtByTarget(this, false, new Class[0]));
+        this.tasks.addTask(1, new EntityAISwimming(this));
+        this.tasks.addTask(2, new EntityAICreeperSwell(this));
+        this.tasks.addTask(3, new EntityAIAvoidEntity(this, EntityOcelot.class, 6.0F, 1.0D, 1.2D));
+        this.tasks.addTask(4, new EntityAIAttackMelee(this, 1.0D, false));
+        this.tasks.addTask(5, new EntityAIWanderAvoidWater(this, 0.8D));
+        this.tasks.addTask(6, new EntityAIWatchClosest(this, EntityPlayer.class, 8.0F));
+        this.tasks.addTask(6, new EntityAILookIdle(this));
+        this.targetTasks.addTask(1, new EntityAINearestAttackableTarget(this, EntityPlayer.class, true));
+        this.targetTasks.addTask(2, new EntityAIHurtByTarget(this, false, new Class[0]));
     }
 
-    protected void func_110147_ax()
+    protected void applyEntityAttributes()
     {
-        super.func_110147_ax();
-        this.func_110148_a(SharedMonsterAttributes.field_111263_d).func_111128_a(0.25D);
+        super.applyEntityAttributes();
+        this.getEntityAttribute(SharedMonsterAttributes.MOVEMENT_SPEED).setBaseValue(0.25D);
     }
 
-    public int func_82143_as()
+    public int getMaxFallHeight()
     {
-        return this.func_70638_az() == null ? 3 : 3 + (int)(this.func_110143_aJ() - 1.0F);
+        return this.getAttackTarget() == null ? 3 : 3 + (int)(this.getHealth() - 1.0F);
     }
 
-    public void func_180430_e(float p_180430_1_, float p_180430_2_)
+    public void fall(float distance, float damageMultiplier)
     {
-        super.func_180430_e(p_180430_1_, p_180430_2_);
-        this.field_70833_d = (int)((float)this.field_70833_d + p_180430_1_ * 1.5F);
+        super.fall(distance, damageMultiplier);
+        this.timeSinceIgnited = (int)((float)this.timeSinceIgnited + distance * 1.5F);
 
-        if (this.field_70833_d > this.field_82225_f - 5)
+        if (this.timeSinceIgnited > this.fuseTime - 5)
         {
-            this.field_70833_d = this.field_82225_f - 5;
+            this.timeSinceIgnited = this.fuseTime - 5;
         }
     }
 
-    protected void func_70088_a()
+    protected void entityInit()
     {
-        super.func_70088_a();
-        this.field_70180_af.func_187214_a(field_184713_a, Integer.valueOf(-1));
-        this.field_70180_af.func_187214_a(field_184714_b, Boolean.valueOf(false));
-        this.field_70180_af.func_187214_a(field_184715_c, Boolean.valueOf(false));
+        super.entityInit();
+        this.dataManager.register(STATE, Integer.valueOf(-1));
+        this.dataManager.register(POWERED, Boolean.valueOf(false));
+        this.dataManager.register(IGNITED, Boolean.valueOf(false));
     }
 
-    public static void func_189762_b(DataFixer p_189762_0_)
+    public static void registerFixesCreeper(DataFixer fixer)
     {
-        EntityLiving.func_189752_a(p_189762_0_, EntityCreeper.class);
+        EntityLiving.registerFixesMob(fixer, EntityCreeper.class);
     }
 
-    public void func_70014_b(NBTTagCompound p_70014_1_)
+    public void writeEntityToNBT(NBTTagCompound compound)
     {
-        super.func_70014_b(p_70014_1_);
+        super.writeEntityToNBT(compound);
 
-        if (((Boolean)this.field_70180_af.func_187225_a(field_184714_b)).booleanValue())
+        if (((Boolean)this.dataManager.get(POWERED)).booleanValue())
         {
-            p_70014_1_.func_74757_a("powered", true);
+            compound.setBoolean("powered", true);
         }
 
-        p_70014_1_.func_74777_a("Fuse", (short)this.field_82225_f);
-        p_70014_1_.func_74774_a("ExplosionRadius", (byte)this.field_82226_g);
-        p_70014_1_.func_74757_a("ignited", this.func_146078_ca());
+        compound.setShort("Fuse", (short)this.fuseTime);
+        compound.setByte("ExplosionRadius", (byte)this.explosionRadius);
+        compound.setBoolean("ignited", this.hasIgnited());
     }
 
-    public void func_70037_a(NBTTagCompound p_70037_1_)
+    public void readEntityFromNBT(NBTTagCompound compound)
     {
-        super.func_70037_a(p_70037_1_);
-        this.field_70180_af.func_187227_b(field_184714_b, Boolean.valueOf(p_70037_1_.func_74767_n("powered")));
+        super.readEntityFromNBT(compound);
+        this.dataManager.set(POWERED, Boolean.valueOf(compound.getBoolean("powered")));
 
-        if (p_70037_1_.func_150297_b("Fuse", 99))
+        if (compound.hasKey("Fuse", 99))
         {
-            this.field_82225_f = p_70037_1_.func_74765_d("Fuse");
+            this.fuseTime = compound.getShort("Fuse");
         }
 
-        if (p_70037_1_.func_150297_b("ExplosionRadius", 99))
+        if (compound.hasKey("ExplosionRadius", 99))
         {
-            this.field_82226_g = p_70037_1_.func_74771_c("ExplosionRadius");
+            this.explosionRadius = compound.getByte("ExplosionRadius");
         }
 
-        if (p_70037_1_.func_74767_n("ignited"))
+        if (compound.getBoolean("ignited"))
         {
-            this.func_146079_cb();
+            this.ignite();
         }
     }
 
-    public void func_70071_h_()
+    public void onUpdate()
     {
-        if (this.func_70089_S())
+        if (this.isEntityAlive())
         {
-            this.field_70834_e = this.field_70833_d;
+            this.lastActiveTime = this.timeSinceIgnited;
 
-            if (this.func_146078_ca())
+            if (this.hasIgnited())
             {
-                this.func_70829_a(1);
+                this.setCreeperState(1);
             }
 
-            int i = this.func_70832_p();
+            int i = this.getCreeperState();
 
-            if (i > 0 && this.field_70833_d == 0)
+            if (i > 0 && this.timeSinceIgnited == 0)
             {
-                this.func_184185_a(SoundEvents.field_187572_ar, 1.0F, 0.5F);
+                this.playSound(SoundEvents.ENTITY_CREEPER_PRIMED, 1.0F, 0.5F);
             }
 
-            this.field_70833_d += i;
+            this.timeSinceIgnited += i;
 
-            if (this.field_70833_d < 0)
+            if (this.timeSinceIgnited < 0)
             {
-                this.field_70833_d = 0;
+                this.timeSinceIgnited = 0;
             }
 
-            if (this.field_70833_d >= this.field_82225_f)
+            if (this.timeSinceIgnited >= this.fuseTime)
             {
-                this.field_70833_d = this.field_82225_f;
-                this.func_146077_cc();
+                this.timeSinceIgnited = this.fuseTime;
+                this.explode();
             }
         }
 
-        super.func_70071_h_();
+        super.onUpdate();
     }
 
-    protected SoundEvent func_184601_bQ()
+    protected SoundEvent getHurtSound()
     {
-        return SoundEvents.field_187570_aq;
+        return SoundEvents.ENTITY_CREEPER_HURT;
     }
 
-    protected SoundEvent func_184615_bR()
+    protected SoundEvent getDeathSound()
     {
-        return SoundEvents.field_187568_ap;
+        return SoundEvents.ENTITY_CREEPER_DEATH;
     }
 
-    public void func_70645_a(DamageSource p_70645_1_)
+    public void onDeath(DamageSource cause)
     {
-        super.func_70645_a(p_70645_1_);
+        super.onDeath(cause);
 
-        if (this.field_70170_p.func_82736_K().func_82766_b("doMobLoot"))
+        if (this.world.getGameRules().getBoolean("doMobLoot"))
         {
-            if (p_70645_1_.func_76346_g() instanceof EntitySkeleton)
+            if (cause.getEntity() instanceof EntitySkeleton)
             {
-                int i = Item.func_150891_b(Items.field_151096_cd);
-                int j = Item.func_150891_b(Items.field_151084_co);
-                int k = i + this.field_70146_Z.nextInt(j - i + 1);
-                this.func_145779_a(Item.func_150899_d(k), 1);
+                int i = Item.getIdFromItem(Items.RECORD_13);
+                int j = Item.getIdFromItem(Items.RECORD_WAIT);
+                int k = i + this.rand.nextInt(j - i + 1);
+                this.dropItem(Item.getItemById(k), 1);
             }
-            else if (p_70645_1_.func_76346_g() instanceof EntityCreeper && p_70645_1_.func_76346_g() != this && ((EntityCreeper)p_70645_1_.func_76346_g()).func_70830_n() && ((EntityCreeper)p_70645_1_.func_76346_g()).func_70650_aV())
+            else if (cause.getEntity() instanceof EntityCreeper && cause.getEntity() != this && ((EntityCreeper)cause.getEntity()).getPowered() && ((EntityCreeper)cause.getEntity()).isAIEnabled())
             {
-                ((EntityCreeper)p_70645_1_.func_76346_g()).func_175493_co();
-                this.func_70099_a(new ItemStack(Items.field_151144_bL, 1, 4), 0.0F);
+                ((EntityCreeper)cause.getEntity()).incrementDroppedSkulls();
+                this.entityDropItem(new ItemStack(Items.SKULL, 1, 4), 0.0F);
             }
         }
     }
 
-    public boolean func_70652_k(Entity p_70652_1_)
+    public boolean attackEntityAsMob(Entity entityIn)
     {
         return true;
     }
 
-    public boolean func_70830_n()
+    public boolean getPowered()
     {
-        return ((Boolean)this.field_70180_af.func_187225_a(field_184714_b)).booleanValue();
+        return ((Boolean)this.dataManager.get(POWERED)).booleanValue();
     }
 
     @SideOnly(Side.CLIENT)
-    public float func_70831_j(float p_70831_1_)
+    public float getCreeperFlashIntensity(float p_70831_1_)
     {
-        return ((float)this.field_70834_e + (float)(this.field_70833_d - this.field_70834_e) * p_70831_1_) / (float)(this.field_82225_f - 2);
+        return ((float)this.lastActiveTime + (float)(this.timeSinceIgnited - this.lastActiveTime) * p_70831_1_) / (float)(this.fuseTime - 2);
     }
 
     @Nullable
-    protected ResourceLocation func_184647_J()
+    protected ResourceLocation getLootTable()
     {
-        return LootTableList.field_186434_p;
+        return LootTableList.ENTITIES_CREEPER;
     }
 
-    public int func_70832_p()
+    public int getCreeperState()
     {
-        return ((Integer)this.field_70180_af.func_187225_a(field_184713_a)).intValue();
+        return ((Integer)this.dataManager.get(STATE)).intValue();
     }
 
-    public void func_70829_a(int p_70829_1_)
+    public void setCreeperState(int state)
     {
-        this.field_70180_af.func_187227_b(field_184713_a, Integer.valueOf(p_70829_1_));
+        this.dataManager.set(STATE, Integer.valueOf(state));
     }
 
-    public void func_70077_a(EntityLightningBolt p_70077_1_)
+    public void onStruckByLightning(EntityLightningBolt lightningBolt)
     {
-        super.func_70077_a(p_70077_1_);
-        this.field_70180_af.func_187227_b(field_184714_b, Boolean.valueOf(true));
+        super.onStruckByLightning(lightningBolt);
+        // CraftBukkit start
+        if (CraftEventFactory.callCreeperPowerEvent(this, lightningBolt, org.bukkit.event.entity.CreeperPowerEvent.PowerCause.LIGHTNING).isCancelled()) {
+            return;
+        }
+        //CraftBukkit end
+        this.dataManager.set(POWERED, Boolean.valueOf(true));
     }
 
-    protected boolean func_184645_a(EntityPlayer p_184645_1_, EnumHand p_184645_2_)
+    protected boolean processInteract(EntityPlayer player, EnumHand hand)
     {
-        ItemStack itemstack = p_184645_1_.func_184586_b(p_184645_2_);
+        ItemStack itemstack = player.getHeldItem(hand);
 
-        if (itemstack.func_77973_b() == Items.field_151033_d)
+        if (itemstack.getItem() == Items.FLINT_AND_STEEL)
         {
-            this.field_70170_p.func_184148_a(p_184645_1_, this.field_70165_t, this.field_70163_u, this.field_70161_v, SoundEvents.field_187649_bu, this.func_184176_by(), 1.0F, this.field_70146_Z.nextFloat() * 0.4F + 0.8F);
-            p_184645_1_.func_184609_a(p_184645_2_);
+            this.world.playSound(player, this.posX, this.posY, this.posZ, SoundEvents.ITEM_FLINTANDSTEEL_USE, this.getSoundCategory(), 1.0F, this.rand.nextFloat() * 0.4F + 0.8F);
+            player.swingArm(hand);
 
-            if (!this.field_70170_p.field_72995_K)
+            if (!this.world.isRemote)
             {
-                this.func_146079_cb();
-                itemstack.func_77972_a(1, p_184645_1_);
+                this.ignite();
+                itemstack.damageItem(1, player);
                 return true;
             }
         }
 
-        return super.func_184645_a(p_184645_1_, p_184645_2_);
+        return super.processInteract(player, hand);
     }
 
-    private void func_146077_cc()
+    private void explode()
     {
-        if (!this.field_70170_p.field_72995_K)
+        if (!this.world.isRemote)
         {
-            boolean flag = this.field_70170_p.func_82736_K().func_82766_b("mobGriefing");
-            float f = this.func_70830_n() ? 2.0F : 1.0F;
-            this.field_70729_aU = true;
-            this.field_70170_p.func_72876_a(this, this.field_70165_t, this.field_70163_u, this.field_70161_v, (float)this.field_82226_g * f, flag);
-            this.func_70106_y();
-            this.func_190741_do();
+            boolean flag = this.world.getGameRules().getBoolean("mobGriefing");
+            float f = this.getPowered() ? 2.0F : 1.0F;
+            this.dead = true;
+            this.world.createExplosion(this, this.posX, this.posY, this.posZ, (float)this.explosionRadius * f, flag);
+            this.setDead();
+            this.spawnLingeringCloud();
         }
     }
 
-    private void func_190741_do()
+    private void spawnLingeringCloud()
     {
-        Collection<PotionEffect> collection = this.func_70651_bq();
+        Collection<PotionEffect> collection = this.getActivePotionEffects();
 
         if (!collection.isEmpty())
         {
-            EntityAreaEffectCloud entityareaeffectcloud = new EntityAreaEffectCloud(this.field_70170_p, this.field_70165_t, this.field_70163_u, this.field_70161_v);
-            entityareaeffectcloud.func_184483_a(2.5F);
-            entityareaeffectcloud.func_184495_b(-0.5F);
-            entityareaeffectcloud.func_184485_d(10);
-            entityareaeffectcloud.func_184486_b(entityareaeffectcloud.func_184489_o() / 2);
-            entityareaeffectcloud.func_184487_c(-entityareaeffectcloud.func_184490_j() / (float)entityareaeffectcloud.func_184489_o());
+            EntityAreaEffectCloud entityareaeffectcloud = new EntityAreaEffectCloud(this.world, this.posX, this.posY, this.posZ);
+            entityareaeffectcloud.setRadius(2.5F);
+            entityareaeffectcloud.setRadiusOnUse(-0.5F);
+            entityareaeffectcloud.setWaitTime(10);
+            entityareaeffectcloud.setDuration(entityareaeffectcloud.getDuration() / 2);
+            entityareaeffectcloud.setRadiusPerTick(-entityareaeffectcloud.getRadius() / (float)entityareaeffectcloud.getDuration());
 
             for (PotionEffect potioneffect : collection)
             {
-                entityareaeffectcloud.func_184496_a(new PotionEffect(potioneffect));
+                entityareaeffectcloud.addEffect(new PotionEffect(potioneffect));
             }
 
-            this.field_70170_p.func_72838_d(entityareaeffectcloud);
+            this.world.spawnEntity(entityareaeffectcloud);
         }
     }
 
-    public boolean func_146078_ca()
+    public boolean hasIgnited()
     {
-        return ((Boolean)this.field_70180_af.func_187225_a(field_184715_c)).booleanValue();
+        return ((Boolean)this.dataManager.get(IGNITED)).booleanValue();
     }
 
-    public void func_146079_cb()
+    public void ignite()
     {
-        this.field_70180_af.func_187227_b(field_184715_c, Boolean.valueOf(true));
+        this.dataManager.set(IGNITED, Boolean.valueOf(true));
     }
 
-    public boolean func_70650_aV()
+    public boolean isAIEnabled()
     {
-        return this.field_175494_bm < 1 && this.field_70170_p.func_82736_K().func_82766_b("doMobLoot");
+        return this.droppedSkulls < 1 && this.world.getGameRules().getBoolean("doMobLoot");
     }
 
-    public void func_175493_co()
+    public void incrementDroppedSkulls()
     {
-        ++this.field_175494_bm;
+        ++this.droppedSkulls;
     }
+
+    public void setPowered(boolean powered) {
+       dataManager.set(POWERED,powered);
+    }
 }
