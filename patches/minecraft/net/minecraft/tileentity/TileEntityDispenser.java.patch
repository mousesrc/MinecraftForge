--- ../src-base/minecraft/net/minecraft/tileentity/TileEntityDispenser.java
+++ ../src-work/minecraft/net/minecraft/tileentity/TileEntityDispenser.java
@@ -1,5 +1,6 @@
 package net.minecraft.tileentity;
 
+import java.util.List;
 import java.util.Random;
 import net.minecraft.entity.player.EntityPlayer;
 import net.minecraft.entity.player.InventoryPlayer;
@@ -12,22 +13,48 @@
 import net.minecraft.util.datafix.DataFixer;
 import net.minecraft.util.datafix.FixTypes;
 import net.minecraft.util.datafix.walkers.ItemStackDataLists;
+import org.bukkit.craftbukkit.entity.CraftHumanEntity;
+import org.bukkit.entity.HumanEntity;
 
 public class TileEntityDispenser extends TileEntityLockableLoot
 {
-    private static final Random field_174913_f = new Random();
-    private NonNullList<ItemStack> field_146022_i = NonNullList.<ItemStack>func_191197_a(9, ItemStack.field_190927_a);
+    private static final Random RNG = new Random();
+    private NonNullList<ItemStack> stacks = NonNullList.<ItemStack>withSize(9, ItemStack.EMPTY);
+    // CraftBukkit start - add fields and methods
+    public List<HumanEntity> transaction = new java.util.ArrayList<HumanEntity>();
+    private int maxStack = 64;
 
-    public int func_70302_i_()
+    public List<ItemStack> getContents() {
+        return this.stacks;
+    }
+
+    public void onOpen(CraftHumanEntity who) {
+        transaction.add(who);
+    }
+
+    public void onClose(CraftHumanEntity who) {
+        transaction.remove(who);
+    }
+
+    public List<HumanEntity> getViewers() {
+        return transaction;
+    }
+
+    public void setMaxStackSize(int size) {
+        maxStack = size;
+    }
+    // CraftBukkit end
+
+    public int getSizeInventory()
     {
         return 9;
     }
 
-    public boolean func_191420_l()
+    public boolean isEmpty()
     {
-        for (ItemStack itemstack : this.field_146022_i)
+        for (ItemStack itemstack : this.stacks)
         {
-            if (!itemstack.func_190926_b())
+            if (!itemstack.isEmpty())
             {
                 return false;
             }
@@ -36,15 +63,15 @@
         return true;
     }
 
-    public int func_146017_i()
+    public int getDispenseSlot()
     {
-        this.func_184281_d((EntityPlayer)null);
+        this.fillWithLoot((EntityPlayer)null);
         int i = -1;
         int j = 1;
 
-        for (int k = 0; k < this.field_146022_i.size(); ++k)
+        for (int k = 0; k < this.stacks.size(); ++k)
         {
-            if (!((ItemStack)this.field_146022_i.get(k)).func_190926_b() && field_174913_f.nextInt(j++) == 0)
+            if (!((ItemStack)this.stacks.get(k)).isEmpty() && RNG.nextInt(j++) == 0)
             {
                 i = k;
             }
@@ -53,13 +80,13 @@
         return i;
     }
 
-    public int func_146019_a(ItemStack p_146019_1_)
+    public int addItemStack(ItemStack stack)
     {
-        for (int i = 0; i < this.field_146022_i.size(); ++i)
+        for (int i = 0; i < this.stacks.size(); ++i)
         {
-            if (((ItemStack)this.field_146022_i.get(i)).func_190926_b())
+            if (((ItemStack)this.stacks.get(i)).isEmpty())
             {
-                this.func_70299_a(i, p_146019_1_);
+                this.setInventorySlotContents(i, stack);
                 return i;
             }
         }
@@ -67,67 +94,67 @@
         return -1;
     }
 
-    public String func_70005_c_()
+    public String getName()
     {
-        return this.func_145818_k_() ? this.field_190577_o : "container.dispenser";
+        return this.hasCustomName() ? this.customName : "container.dispenser";
     }
 
-    public static void func_189678_a(DataFixer p_189678_0_)
+    public static void registerFixes(DataFixer fixer)
     {
-        p_189678_0_.func_188258_a(FixTypes.BLOCK_ENTITY, new ItemStackDataLists(TileEntityDispenser.class, new String[] {"Items"}));
+        fixer.registerWalker(FixTypes.BLOCK_ENTITY, new ItemStackDataLists(TileEntityDispenser.class, new String[] {"Items"}));
     }
 
-    public void func_145839_a(NBTTagCompound p_145839_1_)
+    public void readFromNBT(NBTTagCompound compound)
     {
-        super.func_145839_a(p_145839_1_);
-        this.field_146022_i = NonNullList.<ItemStack>func_191197_a(this.func_70302_i_(), ItemStack.field_190927_a);
+        super.readFromNBT(compound);
+        this.stacks = NonNullList.<ItemStack>withSize(this.getSizeInventory(), ItemStack.EMPTY);
 
-        if (!this.func_184283_b(p_145839_1_))
+        if (!this.checkLootAndRead(compound))
         {
-            ItemStackHelper.func_191283_b(p_145839_1_, this.field_146022_i);
+            ItemStackHelper.loadAllItems(compound, this.stacks);
         }
 
-        if (p_145839_1_.func_150297_b("CustomName", 8))
+        if (compound.hasKey("CustomName", 8))
         {
-            this.field_190577_o = p_145839_1_.func_74779_i("CustomName");
+            this.customName = compound.getString("CustomName");
         }
     }
 
-    public NBTTagCompound func_189515_b(NBTTagCompound p_189515_1_)
+    public NBTTagCompound writeToNBT(NBTTagCompound compound)
     {
-        super.func_189515_b(p_189515_1_);
+        super.writeToNBT(compound);
 
-        if (!this.func_184282_c(p_189515_1_))
+        if (!this.checkLootAndWrite(compound))
         {
-            ItemStackHelper.func_191282_a(p_189515_1_, this.field_146022_i);
+            ItemStackHelper.saveAllItems(compound, this.stacks);
         }
 
-        if (this.func_145818_k_())
+        if (this.hasCustomName())
         {
-            p_189515_1_.func_74778_a("CustomName", this.field_190577_o);
+            compound.setString("CustomName", this.customName);
         }
 
-        return p_189515_1_;
+        return compound;
     }
 
-    public int func_70297_j_()
+    public int getInventoryStackLimit()
     {
         return 64;
     }
 
-    public String func_174875_k()
+    public String getGuiID()
     {
         return "minecraft:dispenser";
     }
 
-    public Container func_174876_a(InventoryPlayer p_174876_1_, EntityPlayer p_174876_2_)
+    public Container createContainer(InventoryPlayer playerInventory, EntityPlayer playerIn)
     {
-        this.func_184281_d(p_174876_2_);
-        return new ContainerDispenser(p_174876_1_, this);
+        this.fillWithLoot(playerIn);
+        return new ContainerDispenser(playerInventory, this);
     }
 
-    protected NonNullList<ItemStack> func_190576_q()
+    protected NonNullList<ItemStack> getItems()
     {
-        return this.field_146022_i;
+        return this.stacks;
     }
 }
