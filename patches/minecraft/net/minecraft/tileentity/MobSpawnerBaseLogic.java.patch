--- ../src-base/minecraft/net/minecraft/tileentity/MobSpawnerBaseLogic.java
+++ ../src-work/minecraft/net/minecraft/tileentity/MobSpawnerBaseLogic.java
@@ -5,6 +5,7 @@
 import javax.annotation.Nullable;
 import net.minecraft.entity.Entity;
 import net.minecraft.entity.EntityLiving;
+import net.minecraft.entity.EntityLivingBase;
 import net.minecraft.entity.IEntityLivingData;
 import net.minecraft.nbt.NBTTagCompound;
 import net.minecraft.nbt.NBTTagList;
@@ -19,124 +20,131 @@
 import net.minecraft.world.chunk.storage.AnvilChunkLoader;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
+import org.bukkit.craftbukkit.CraftServer;
+import org.bukkit.craftbukkit.event.CraftEventFactory;
+import org.bukkit.event.entity.CreatureSpawnEvent;
 
 public abstract class MobSpawnerBaseLogic
 {
-    public int field_98286_b = 20;
-    private final List<WeightedSpawnerEntity> field_98285_e = Lists.<WeightedSpawnerEntity>newArrayList();
-    private WeightedSpawnerEntity field_98282_f = new WeightedSpawnerEntity();
-    private double field_98287_c;
-    private double field_98284_d;
-    private int field_98283_g = 200;
-    private int field_98293_h = 800;
-    private int field_98294_i = 4;
-    private Entity field_98291_j;
-    private int field_98292_k = 6;
-    private int field_98289_l = 16;
-    private int field_98290_m = 4;
+    public int spawnDelay = 20;
+    private final List<WeightedSpawnerEntity> potentialSpawns = Lists.<WeightedSpawnerEntity>newArrayList();
+    private WeightedSpawnerEntity randomEntity = new WeightedSpawnerEntity();
+    private double mobRotation;
+    private double prevMobRotation;
+    private int minSpawnDelay = 200;
+    private int maxSpawnDelay = 800;
+    private int spawnCount = 4;
+    private Entity cachedEntity;
+    private int maxNearbyEntities = 6;
+    private int activatingRangeFromPlayer = 16;
+    private int spawnRange = 4;
 
     @Nullable
-    public ResourceLocation func_190895_g()
+    public ResourceLocation getEntityId()
     {
-        String s = this.field_98282_f.func_185277_b().func_74779_i("id");
-        return StringUtils.func_151246_b(s) ? null : new ResourceLocation(s);
+        String s = this.randomEntity.getNbt().getString("id");
+        return StringUtils.isNullOrEmpty(s) ? null : new ResourceLocation(s);
     }
 
-    public void func_190894_a(@Nullable ResourceLocation p_190894_1_)
+    public void setEntityId(@Nullable ResourceLocation id)
     {
-        if (p_190894_1_ != null)
+        if (id != null)
         {
-            this.field_98282_f.func_185277_b().func_74778_a("id", p_190894_1_.toString());
+            this.randomEntity.getNbt().setString("id", id.toString());
         }
     }
 
-    private boolean func_98279_f()
+    private boolean isActivated()
     {
-        BlockPos blockpos = this.func_177221_b();
-        return this.func_98271_a().func_175636_b((double)blockpos.func_177958_n() + 0.5D, (double)blockpos.func_177956_o() + 0.5D, (double)blockpos.func_177952_p() + 0.5D, (double)this.field_98289_l);
+        BlockPos blockpos = this.getSpawnerPosition();
+        return this.getSpawnerWorld().isAnyPlayerWithinRangeAt((double)blockpos.getX() + 0.5D, (double)blockpos.getY() + 0.5D, (double)blockpos.getZ() + 0.5D, (double)this.activatingRangeFromPlayer);
     }
 
-    public void func_98278_g()
+    public void updateSpawner()
     {
-        if (!this.func_98279_f())
+        if (!this.isActivated())
         {
-            this.field_98284_d = this.field_98287_c;
+            this.prevMobRotation = this.mobRotation;
         }
         else
         {
-            BlockPos blockpos = this.func_177221_b();
+            BlockPos blockpos = this.getSpawnerPosition();
 
-            if (this.func_98271_a().field_72995_K)
+            if (this.getSpawnerWorld().isRemote)
             {
-                double d3 = (double)((float)blockpos.func_177958_n() + this.func_98271_a().field_73012_v.nextFloat());
-                double d4 = (double)((float)blockpos.func_177956_o() + this.func_98271_a().field_73012_v.nextFloat());
-                double d5 = (double)((float)blockpos.func_177952_p() + this.func_98271_a().field_73012_v.nextFloat());
-                this.func_98271_a().func_175688_a(EnumParticleTypes.SMOKE_NORMAL, d3, d4, d5, 0.0D, 0.0D, 0.0D, new int[0]);
-                this.func_98271_a().func_175688_a(EnumParticleTypes.FLAME, d3, d4, d5, 0.0D, 0.0D, 0.0D, new int[0]);
+                double d3 = (double)((float)blockpos.getX() + this.getSpawnerWorld().rand.nextFloat());
+                double d4 = (double)((float)blockpos.getY() + this.getSpawnerWorld().rand.nextFloat());
+                double d5 = (double)((float)blockpos.getZ() + this.getSpawnerWorld().rand.nextFloat());
+                this.getSpawnerWorld().spawnParticle(EnumParticleTypes.SMOKE_NORMAL, d3, d4, d5, 0.0D, 0.0D, 0.0D, new int[0]);
+                this.getSpawnerWorld().spawnParticle(EnumParticleTypes.FLAME, d3, d4, d5, 0.0D, 0.0D, 0.0D, new int[0]);
 
-                if (this.field_98286_b > 0)
+                if (this.spawnDelay > 0)
                 {
-                    --this.field_98286_b;
+                    --this.spawnDelay;
                 }
 
-                this.field_98284_d = this.field_98287_c;
-                this.field_98287_c = (this.field_98287_c + (double)(1000.0F / ((float)this.field_98286_b + 200.0F))) % 360.0D;
+                this.prevMobRotation = this.mobRotation;
+                this.mobRotation = (this.mobRotation + (double)(1000.0F / ((float)this.spawnDelay + 200.0F))) % 360.0D;
             }
             else
             {
-                if (this.field_98286_b == -1)
+                if (this.spawnDelay == -1)
                 {
-                    this.func_98273_j();
+                    this.resetTimer();
                 }
 
-                if (this.field_98286_b > 0)
+                if (this.spawnDelay > 0)
                 {
-                    --this.field_98286_b;
+                    --this.spawnDelay;
                     return;
                 }
 
                 boolean flag = false;
 
-                for (int i = 0; i < this.field_98294_i; ++i)
+                for (int i = 0; i < this.spawnCount; ++i)
                 {
-                    NBTTagCompound nbttagcompound = this.field_98282_f.func_185277_b();
-                    NBTTagList nbttaglist = nbttagcompound.func_150295_c("Pos", 6);
-                    World world = this.func_98271_a();
-                    int j = nbttaglist.func_74745_c();
-                    double d0 = j >= 1 ? nbttaglist.func_150309_d(0) : (double)blockpos.func_177958_n() + (world.field_73012_v.nextDouble() - world.field_73012_v.nextDouble()) * (double)this.field_98290_m + 0.5D;
-                    double d1 = j >= 2 ? nbttaglist.func_150309_d(1) : (double)(blockpos.func_177956_o() + world.field_73012_v.nextInt(3) - 1);
-                    double d2 = j >= 3 ? nbttaglist.func_150309_d(2) : (double)blockpos.func_177952_p() + (world.field_73012_v.nextDouble() - world.field_73012_v.nextDouble()) * (double)this.field_98290_m + 0.5D;
-                    Entity entity = AnvilChunkLoader.func_186054_a(nbttagcompound, world, d0, d1, d2, false);
+                    NBTTagCompound nbttagcompound = this.randomEntity.getNbt();
+                    NBTTagList nbttaglist = nbttagcompound.getTagList("Pos", 6);
+                    World world = this.getSpawnerWorld();
+                    int j = nbttaglist.tagCount();
+                    double d0 = j >= 1 ? nbttaglist.getDoubleAt(0) : (double)blockpos.getX() + (world.rand.nextDouble() - world.rand.nextDouble()) * (double)this.spawnRange + 0.5D;
+                    double d1 = j >= 2 ? nbttaglist.getDoubleAt(1) : (double)(blockpos.getY() + world.rand.nextInt(3) - 1);
+                    double d2 = j >= 3 ? nbttaglist.getDoubleAt(2) : (double)blockpos.getZ() + (world.rand.nextDouble() - world.rand.nextDouble()) * (double)this.spawnRange + 0.5D;
+                    Entity entity = AnvilChunkLoader.readWorldEntityPos(nbttagcompound, world, d0, d1, d2, false);
 
                     if (entity == null)
                     {
                         return;
                     }
 
-                    int k = world.func_72872_a(entity.getClass(), (new AxisAlignedBB((double)blockpos.func_177958_n(), (double)blockpos.func_177956_o(), (double)blockpos.func_177952_p(), (double)(blockpos.func_177958_n() + 1), (double)(blockpos.func_177956_o() + 1), (double)(blockpos.func_177952_p() + 1))).func_186662_g((double)this.field_98290_m)).size();
+                    int k = world.getEntitiesWithinAABB(entity.getClass(), (new AxisAlignedBB((double)blockpos.getX(), (double)blockpos.getY(), (double)blockpos.getZ(), (double)(blockpos.getX() + 1), (double)(blockpos.getY() + 1), (double)(blockpos.getZ() + 1))).expandXyz((double)this.spawnRange)).size();
 
-                    if (k >= this.field_98292_k)
+                    if (k >= this.maxNearbyEntities)
                     {
-                        this.func_98273_j();
+                        this.resetTimer();
                         return;
                     }
 
                     EntityLiving entityliving = entity instanceof EntityLiving ? (EntityLiving)entity : null;
-                    entity.func_70012_b(entity.field_70165_t, entity.field_70163_u, entity.field_70161_v, world.field_73012_v.nextFloat() * 360.0F, 0.0F);
+                    entity.setLocationAndAngles(entity.posX, entity.posY, entity.posZ, world.rand.nextFloat() * 360.0F, 0.0F);
 
-                    if (entityliving == null || entityliving.func_70601_bi() && entityliving.func_70058_J())
+                    if (entityliving == null || net.minecraftforge.event.ForgeEventFactory.canEntitySpawnSpawner(entityliving, getSpawnerWorld(), (float)entity.posX, (float)entity.posY, (float)entity.posZ))
                     {
-                        if (this.field_98282_f.func_185277_b().func_186856_d() == 1 && this.field_98282_f.func_185277_b().func_150297_b("id", 8) && entity instanceof EntityLiving)
+                        if (this.randomEntity.getNbt().getSize() == 1 && this.randomEntity.getNbt().hasKey("id", 8) && entity instanceof EntityLiving)
                         {
-                            ((EntityLiving)entity).func_180482_a(world.func_175649_E(new BlockPos(entity)), (IEntityLivingData)null);
+                            if (!net.minecraftforge.event.ForgeEventFactory.doSpecialSpawn(entityliving, this.getSpawnerWorld(), (float)entity.posX, (float)entity.posY, (float)entity.posZ))
+                            ((EntityLiving)entity).onInitialSpawn(world.getDifficultyForLocation(new BlockPos(entity)), (IEntityLivingData)null);
                         }
+                        if(CraftEventFactory.callCreatureSpawnEvent((EntityLivingBase) entity, CreatureSpawnEvent.SpawnReason.SPAWNER).isCancelled())
+                        {
+                            return;
+                        }
+                        AnvilChunkLoader.spawnEntity(entity, world);
+                        world.playEvent(2004, blockpos, 0);
 
-                        AnvilChunkLoader.func_186052_a(entity, world);
-                        world.func_175718_b(2004, blockpos, 0);
-
                         if (entityliving != null)
                         {
-                            entityliving.func_70656_aK();
+                            entityliving.spawnExplosionParticle();
                         }
 
                         flag = true;
@@ -145,83 +153,83 @@
 
                 if (flag)
                 {
-                    this.func_98273_j();
+                    this.resetTimer();
                 }
             }
         }
     }
 
-    private void func_98273_j()
+    private void resetTimer()
     {
-        if (this.field_98293_h <= this.field_98283_g)
+        if (this.maxSpawnDelay <= this.minSpawnDelay)
         {
-            this.field_98286_b = this.field_98283_g;
+            this.spawnDelay = this.minSpawnDelay;
         }
         else
         {
-            int i = this.field_98293_h - this.field_98283_g;
-            this.field_98286_b = this.field_98283_g + this.func_98271_a().field_73012_v.nextInt(i);
+            int i = this.maxSpawnDelay - this.minSpawnDelay;
+            this.spawnDelay = this.minSpawnDelay + this.getSpawnerWorld().rand.nextInt(i);
         }
 
-        if (!this.field_98285_e.isEmpty())
+        if (!this.potentialSpawns.isEmpty())
         {
-            this.func_184993_a((WeightedSpawnerEntity)WeightedRandom.func_76271_a(this.func_98271_a().field_73012_v, this.field_98285_e));
+            this.setNextSpawnData((WeightedSpawnerEntity)WeightedRandom.getRandomItem(this.getSpawnerWorld().rand, this.potentialSpawns));
         }
 
-        this.func_98267_a(1);
+        this.broadcastEvent(1);
     }
 
-    public void func_98270_a(NBTTagCompound p_98270_1_)
+    public void readFromNBT(NBTTagCompound nbt)
     {
-        this.field_98286_b = p_98270_1_.func_74765_d("Delay");
-        this.field_98285_e.clear();
+        this.spawnDelay = nbt.getShort("Delay");
+        this.potentialSpawns.clear();
 
-        if (p_98270_1_.func_150297_b("SpawnPotentials", 9))
+        if (nbt.hasKey("SpawnPotentials", 9))
         {
-            NBTTagList nbttaglist = p_98270_1_.func_150295_c("SpawnPotentials", 10);
+            NBTTagList nbttaglist = nbt.getTagList("SpawnPotentials", 10);
 
-            for (int i = 0; i < nbttaglist.func_74745_c(); ++i)
+            for (int i = 0; i < nbttaglist.tagCount(); ++i)
             {
-                this.field_98285_e.add(new WeightedSpawnerEntity(nbttaglist.func_150305_b(i)));
+                this.potentialSpawns.add(new WeightedSpawnerEntity(nbttaglist.getCompoundTagAt(i)));
             }
         }
 
-        if (p_98270_1_.func_150297_b("SpawnData", 10))
+        if (nbt.hasKey("SpawnData", 10))
         {
-            this.func_184993_a(new WeightedSpawnerEntity(1, p_98270_1_.func_74775_l("SpawnData")));
+            this.setNextSpawnData(new WeightedSpawnerEntity(1, nbt.getCompoundTag("SpawnData")));
         }
-        else if (!this.field_98285_e.isEmpty())
+        else if (!this.potentialSpawns.isEmpty())
         {
-            this.func_184993_a((WeightedSpawnerEntity)WeightedRandom.func_76271_a(this.func_98271_a().field_73012_v, this.field_98285_e));
+            this.setNextSpawnData((WeightedSpawnerEntity)WeightedRandom.getRandomItem(this.getSpawnerWorld().rand, this.potentialSpawns));
         }
 
-        if (p_98270_1_.func_150297_b("MinSpawnDelay", 99))
+        if (nbt.hasKey("MinSpawnDelay", 99))
         {
-            this.field_98283_g = p_98270_1_.func_74765_d("MinSpawnDelay");
-            this.field_98293_h = p_98270_1_.func_74765_d("MaxSpawnDelay");
-            this.field_98294_i = p_98270_1_.func_74765_d("SpawnCount");
+            this.minSpawnDelay = nbt.getShort("MinSpawnDelay");
+            this.maxSpawnDelay = nbt.getShort("MaxSpawnDelay");
+            this.spawnCount = nbt.getShort("SpawnCount");
         }
 
-        if (p_98270_1_.func_150297_b("MaxNearbyEntities", 99))
+        if (nbt.hasKey("MaxNearbyEntities", 99))
         {
-            this.field_98292_k = p_98270_1_.func_74765_d("MaxNearbyEntities");
-            this.field_98289_l = p_98270_1_.func_74765_d("RequiredPlayerRange");
+            this.maxNearbyEntities = nbt.getShort("MaxNearbyEntities");
+            this.activatingRangeFromPlayer = nbt.getShort("RequiredPlayerRange");
         }
 
-        if (p_98270_1_.func_150297_b("SpawnRange", 99))
+        if (nbt.hasKey("SpawnRange", 99))
         {
-            this.field_98290_m = p_98270_1_.func_74765_d("SpawnRange");
+            this.spawnRange = nbt.getShort("SpawnRange");
         }
 
-        if (this.func_98271_a() != null)
+        if (this.getSpawnerWorld() != null)
         {
-            this.field_98291_j = null;
+            this.cachedEntity = null;
         }
     }
 
-    public NBTTagCompound func_189530_b(NBTTagCompound p_189530_1_)
+    public NBTTagCompound writeToNBT(NBTTagCompound p_189530_1_)
     {
-        ResourceLocation resourcelocation = this.func_190895_g();
+        ResourceLocation resourcelocation = this.getEntityId();
 
         if (resourcelocation == null)
         {
@@ -229,38 +237,38 @@
         }
         else
         {
-            p_189530_1_.func_74777_a("Delay", (short)this.field_98286_b);
-            p_189530_1_.func_74777_a("MinSpawnDelay", (short)this.field_98283_g);
-            p_189530_1_.func_74777_a("MaxSpawnDelay", (short)this.field_98293_h);
-            p_189530_1_.func_74777_a("SpawnCount", (short)this.field_98294_i);
-            p_189530_1_.func_74777_a("MaxNearbyEntities", (short)this.field_98292_k);
-            p_189530_1_.func_74777_a("RequiredPlayerRange", (short)this.field_98289_l);
-            p_189530_1_.func_74777_a("SpawnRange", (short)this.field_98290_m);
-            p_189530_1_.func_74782_a("SpawnData", this.field_98282_f.func_185277_b().func_74737_b());
+            p_189530_1_.setShort("Delay", (short)this.spawnDelay);
+            p_189530_1_.setShort("MinSpawnDelay", (short)this.minSpawnDelay);
+            p_189530_1_.setShort("MaxSpawnDelay", (short)this.maxSpawnDelay);
+            p_189530_1_.setShort("SpawnCount", (short)this.spawnCount);
+            p_189530_1_.setShort("MaxNearbyEntities", (short)this.maxNearbyEntities);
+            p_189530_1_.setShort("RequiredPlayerRange", (short)this.activatingRangeFromPlayer);
+            p_189530_1_.setShort("SpawnRange", (short)this.spawnRange);
+            p_189530_1_.setTag("SpawnData", this.randomEntity.getNbt().copy());
             NBTTagList nbttaglist = new NBTTagList();
 
-            if (this.field_98285_e.isEmpty())
+            if (this.potentialSpawns.isEmpty())
             {
-                nbttaglist.func_74742_a(this.field_98282_f.func_185278_a());
+                nbttaglist.appendTag(this.randomEntity.toCompoundTag());
             }
             else
             {
-                for (WeightedSpawnerEntity weightedspawnerentity : this.field_98285_e)
+                for (WeightedSpawnerEntity weightedspawnerentity : this.potentialSpawns)
                 {
-                    nbttaglist.func_74742_a(weightedspawnerentity.func_185278_a());
+                    nbttaglist.appendTag(weightedspawnerentity.toCompoundTag());
                 }
             }
 
-            p_189530_1_.func_74782_a("SpawnPotentials", nbttaglist);
+            p_189530_1_.setTag("SpawnPotentials", nbttaglist);
             return p_189530_1_;
         }
     }
 
-    public boolean func_98268_b(int p_98268_1_)
+    public boolean setDelayToMin(int delay)
     {
-        if (p_98268_1_ == 1 && this.func_98271_a().field_72995_K)
+        if (delay == 1 && this.getSpawnerWorld().isRemote)
         {
-            this.field_98286_b = this.field_98283_g;
+            this.spawnDelay = this.minSpawnDelay;
             return true;
         }
         else
@@ -270,41 +278,41 @@
     }
 
     @SideOnly(Side.CLIENT)
-    public Entity func_184994_d()
+    public Entity getCachedEntity()
     {
-        if (this.field_98291_j == null)
+        if (this.cachedEntity == null)
         {
-            this.field_98291_j = AnvilChunkLoader.func_186051_a(this.field_98282_f.func_185277_b(), this.func_98271_a(), false);
+            this.cachedEntity = AnvilChunkLoader.readWorldEntity(this.randomEntity.getNbt(), this.getSpawnerWorld(), false);
 
-            if (this.field_98282_f.func_185277_b().func_186856_d() == 1 && this.field_98282_f.func_185277_b().func_150297_b("id", 8) && this.field_98291_j instanceof EntityLiving)
+            if (this.randomEntity.getNbt().getSize() == 1 && this.randomEntity.getNbt().hasKey("id", 8) && this.cachedEntity instanceof EntityLiving)
             {
-                ((EntityLiving)this.field_98291_j).func_180482_a(this.func_98271_a().func_175649_E(new BlockPos(this.field_98291_j)), (IEntityLivingData)null);
+                ((EntityLiving)this.cachedEntity).onInitialSpawn(this.getSpawnerWorld().getDifficultyForLocation(new BlockPos(this.cachedEntity)), (IEntityLivingData)null);
             }
         }
 
-        return this.field_98291_j;
+        return this.cachedEntity;
     }
 
-    public void func_184993_a(WeightedSpawnerEntity p_184993_1_)
+    public void setNextSpawnData(WeightedSpawnerEntity p_184993_1_)
     {
-        this.field_98282_f = p_184993_1_;
+        this.randomEntity = p_184993_1_;
     }
 
-    public abstract void func_98267_a(int p_98267_1_);
+    public abstract void broadcastEvent(int id);
 
-    public abstract World func_98271_a();
+    public abstract World getSpawnerWorld();
 
-    public abstract BlockPos func_177221_b();
+    public abstract BlockPos getSpawnerPosition();
 
     @SideOnly(Side.CLIENT)
-    public double func_177222_d()
+    public double getMobRotation()
     {
-        return this.field_98287_c;
+        return this.mobRotation;
     }
 
     @SideOnly(Side.CLIENT)
-    public double func_177223_e()
+    public double getPrevMobRotation()
     {
-        return this.field_98284_d;
+        return this.prevMobRotation;
     }
 }
