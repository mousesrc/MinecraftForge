--- ../src-base/minecraft/net/minecraft/inventory/ContainerHorseInventory.java
+++ ../src-work/minecraft/net/minecraft/inventory/ContainerHorseInventory.java
@@ -3,59 +3,76 @@
 import net.minecraft.entity.passive.AbstractChestHorse;
 import net.minecraft.entity.passive.AbstractHorse;
 import net.minecraft.entity.player.EntityPlayer;
+import net.minecraft.entity.player.InventoryPlayer;
 import net.minecraft.init.Items;
 import net.minecraft.item.ItemStack;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
+import org.bukkit.craftbukkit.inventory.CraftInventoryView;
+import org.bukkit.inventory.InventoryView;
 
 public class ContainerHorseInventory extends Container
 {
-    private final IInventory field_111243_a;
-    private final AbstractHorse field_111242_f;
+    private final IInventory horseInventory;
+    private final AbstractHorse theHorse;
+    // CraftBukkit start
+    CraftInventoryView bukkitEntity;
+    InventoryPlayer player;
 
-    public ContainerHorseInventory(IInventory p_i45791_1_, final IInventory p_i45791_2_, final AbstractHorse p_i45791_3_, EntityPlayer p_i45791_4_)
+    @Override
+    public InventoryView getBukkitView() {
+        if (bukkitEntity != null) {
+            return bukkitEntity;
+        }
+
+        return bukkitEntity = new CraftInventoryView(player.player.getBukkitEntity(), horseInventory.getOwner().getInventory(), this);
+    }
+
+    public ContainerHorseInventory(IInventory playerInventory, final IInventory horseInventoryIn, final AbstractHorse horse, EntityPlayer player)
     {
-        this.field_111243_a = p_i45791_2_;
-        this.field_111242_f = p_i45791_3_;
+        this.player = (InventoryPlayer) playerInventory;
+        // CraftBukkit end
+        this.horseInventory = horseInventoryIn;
+        this.theHorse = horse;
         int i = 3;
-        p_i45791_2_.func_174889_b(p_i45791_4_);
+        horseInventoryIn.openInventory(player);
         int j = -18;
-        this.func_75146_a(new Slot(p_i45791_2_, 0, 8, 18)
+        this.addSlotToContainer(new Slot(horseInventoryIn, 0, 8, 18)
         {
-            public boolean func_75214_a(ItemStack p_75214_1_)
+            public boolean isItemValid(ItemStack stack)
             {
-                return p_75214_1_.func_77973_b() == Items.field_151141_av && !this.func_75216_d() && p_i45791_3_.func_190685_dA();
+                return stack.getItem() == Items.SADDLE && !this.getHasStack() && horse.canBeSaddled();
             }
             @SideOnly(Side.CLIENT)
-            public boolean func_111238_b()
+            public boolean canBeHovered()
             {
-                return p_i45791_3_.func_190685_dA();
+                return horse.canBeSaddled();
             }
         });
-        this.func_75146_a(new Slot(p_i45791_2_, 1, 8, 36)
+        this.addSlotToContainer(new Slot(horseInventoryIn, 1, 8, 36)
         {
-            public boolean func_75214_a(ItemStack p_75214_1_)
+            public boolean isItemValid(ItemStack stack)
             {
-                return p_i45791_3_.func_190682_f(p_75214_1_);
+                return horse.isArmor(stack);
             }
-            public int func_75219_a()
+            public int getSlotStackLimit()
             {
                 return 1;
             }
             @SideOnly(Side.CLIENT)
-            public boolean func_111238_b()
+            public boolean canBeHovered()
             {
-                return p_i45791_3_.func_190677_dK();
+                return horse.wearsArmor();
             }
         });
 
-        if (p_i45791_3_ instanceof AbstractChestHorse && ((AbstractChestHorse)p_i45791_3_).func_190695_dh())
+        if (horse instanceof AbstractChestHorse && ((AbstractChestHorse)horse).hasChest())
         {
             for (int k = 0; k < 3; ++k)
             {
-                for (int l = 0; l < ((AbstractChestHorse)p_i45791_3_).func_190696_dl(); ++l)
+                for (int l = 0; l < ((AbstractChestHorse)horse).getInventoryColumns(); ++l)
                 {
-                    this.func_75146_a(new Slot(p_i45791_2_, 2 + l + k * ((AbstractChestHorse)p_i45791_3_).func_190696_dl(), 80 + l * 18, 18 + k * 18));
+                    this.addSlotToContainer(new Slot(horseInventoryIn, 2 + l + k * ((AbstractChestHorse)horse).getInventoryColumns(), 80 + l * 18, 18 + k * 18));
                 }
             }
         }
@@ -64,73 +81,73 @@
         {
             for (int k1 = 0; k1 < 9; ++k1)
             {
-                this.func_75146_a(new Slot(p_i45791_1_, k1 + i1 * 9 + 9, 8 + k1 * 18, 102 + i1 * 18 + -18));
+                this.addSlotToContainer(new Slot(playerInventory, k1 + i1 * 9 + 9, 8 + k1 * 18, 102 + i1 * 18 + -18));
             }
         }
 
         for (int j1 = 0; j1 < 9; ++j1)
         {
-            this.func_75146_a(new Slot(p_i45791_1_, j1, 8 + j1 * 18, 142));
+            this.addSlotToContainer(new Slot(playerInventory, j1, 8 + j1 * 18, 142));
         }
     }
 
-    public boolean func_75145_c(EntityPlayer p_75145_1_)
+    public boolean canInteractWith(EntityPlayer playerIn)
     {
-        return this.field_111243_a.func_70300_a(p_75145_1_) && this.field_111242_f.func_70089_S() && this.field_111242_f.func_70032_d(p_75145_1_) < 8.0F;
+        return this.horseInventory.isUsableByPlayer(playerIn) && this.theHorse.isEntityAlive() && this.theHorse.getDistanceToEntity(playerIn) < 8.0F;
     }
 
-    public ItemStack func_82846_b(EntityPlayer p_82846_1_, int p_82846_2_)
+    public ItemStack transferStackInSlot(EntityPlayer playerIn, int index)
     {
-        ItemStack itemstack = ItemStack.field_190927_a;
-        Slot slot = (Slot)this.field_75151_b.get(p_82846_2_);
+        ItemStack itemstack = ItemStack.EMPTY;
+        Slot slot = (Slot)this.inventorySlots.get(index);
 
-        if (slot != null && slot.func_75216_d())
+        if (slot != null && slot.getHasStack())
         {
-            ItemStack itemstack1 = slot.func_75211_c();
-            itemstack = itemstack1.func_77946_l();
+            ItemStack itemstack1 = slot.getStack();
+            itemstack = itemstack1.copy();
 
-            if (p_82846_2_ < this.field_111243_a.func_70302_i_())
+            if (index < this.horseInventory.getSizeInventory())
             {
-                if (!this.func_75135_a(itemstack1, this.field_111243_a.func_70302_i_(), this.field_75151_b.size(), true))
+                if (!this.mergeItemStack(itemstack1, this.horseInventory.getSizeInventory(), this.inventorySlots.size(), true))
                 {
-                    return ItemStack.field_190927_a;
+                    return ItemStack.EMPTY;
                 }
             }
-            else if (this.func_75139_a(1).func_75214_a(itemstack1) && !this.func_75139_a(1).func_75216_d())
+            else if (this.getSlot(1).isItemValid(itemstack1) && !this.getSlot(1).getHasStack())
             {
-                if (!this.func_75135_a(itemstack1, 1, 2, false))
+                if (!this.mergeItemStack(itemstack1, 1, 2, false))
                 {
-                    return ItemStack.field_190927_a;
+                    return ItemStack.EMPTY;
                 }
             }
-            else if (this.func_75139_a(0).func_75214_a(itemstack1))
+            else if (this.getSlot(0).isItemValid(itemstack1))
             {
-                if (!this.func_75135_a(itemstack1, 0, 1, false))
+                if (!this.mergeItemStack(itemstack1, 0, 1, false))
                 {
-                    return ItemStack.field_190927_a;
+                    return ItemStack.EMPTY;
                 }
             }
-            else if (this.field_111243_a.func_70302_i_() <= 2 || !this.func_75135_a(itemstack1, 2, this.field_111243_a.func_70302_i_(), false))
+            else if (this.horseInventory.getSizeInventory() <= 2 || !this.mergeItemStack(itemstack1, 2, this.horseInventory.getSizeInventory(), false))
             {
-                return ItemStack.field_190927_a;
+                return ItemStack.EMPTY;
             }
 
-            if (itemstack1.func_190926_b())
+            if (itemstack1.isEmpty())
             {
-                slot.func_75215_d(ItemStack.field_190927_a);
+                slot.putStack(ItemStack.EMPTY);
             }
             else
             {
-                slot.func_75218_e();
+                slot.onSlotChanged();
             }
         }
 
         return itemstack;
     }
 
-    public void func_75134_a(EntityPlayer p_75134_1_)
+    public void onContainerClosed(EntityPlayer playerIn)
     {
-        super.func_75134_a(p_75134_1_);
-        this.field_111243_a.func_174886_c(p_75134_1_);
+        super.onContainerClosed(playerIn);
+        this.horseInventory.closeInventory(playerIn);
     }
 }
