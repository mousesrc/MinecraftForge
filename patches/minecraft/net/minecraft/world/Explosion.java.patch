--- ../src-base/minecraft/net/minecraft/world/Explosion.java
+++ ../src-work/minecraft/net/minecraft/world/Explosion.java
@@ -3,10 +3,8 @@
 import com.google.common.collect.Lists;
 import com.google.common.collect.Maps;
 import com.google.common.collect.Sets;
-import java.util.List;
-import java.util.Map;
-import java.util.Random;
-import java.util.Set;
+
+import java.util.*;
 import javax.annotation.Nullable;
 import net.minecraft.block.Block;
 import net.minecraft.block.material.Material;
@@ -25,8 +23,18 @@
 import net.minecraft.util.math.BlockPos;
 import net.minecraft.util.math.MathHelper;
 import net.minecraft.util.math.Vec3d;
+import net.minecraftforge.event.ForgeEventFactory;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
+import org.bukkit.Location;
+import org.bukkit.craftbukkit.entity.CraftCustomExplosive;
+import org.bukkit.craftbukkit.event.CraftEventFactory;
+import org.bukkit.entity.Explosive;
+import org.bukkit.event.Cancellable;
+import org.bukkit.event.Event;
+import org.bukkit.event.block.BlockExplodeEvent;
+import org.bukkit.event.entity.EntityExplodeEvent;
+import org.bukkit.event.entity.ExplosionPrimeEvent;
 
 public class Explosion
 {
@@ -38,10 +46,11 @@
     private final double field_77285_c;
     private final double field_77282_d;
     public final Entity field_77283_e;
-    private final float field_77280_f;
+    float field_77280_f;
     private final List<BlockPos> field_77281_g;
     private final Map<EntityPlayer, Vec3d> field_77288_k;
-
+    private final Vec3d position;
+    public boolean isCanceled = false;
     @SideOnly(Side.CLIENT)
     public Explosion(World p_i45752_1_, Entity p_i45752_2_, double p_i45752_3_, double p_i45752_5_, double p_i45752_7_, float p_i45752_9_, List<BlockPos> p_i45752_10_)
     {
@@ -68,6 +77,7 @@
         this.field_77282_d = p_i45754_7_;
         this.field_77286_a = p_i45754_10_;
         this.field_82755_b = p_i45754_11_;
+        this.position = new Vec3d(field_77284_b, field_77285_c, field_77282_d);
     }
 
     public void func_77278_a()
@@ -102,7 +112,7 @@
 
                             if (iblockstate.func_185904_a() != Material.field_151579_a)
                             {
-                                float f2 = this.field_77283_e != null ? this.field_77283_e.func_180428_a(this, this.field_77287_j, blockpos, iblockstate) : iblockstate.func_177230_c().func_149638_a((Entity)null);
+                                float f2 = this.field_77283_e != null ? this.field_77283_e.func_180428_a(this, this.field_77287_j, blockpos, iblockstate) : iblockstate.func_177230_c().getExplosionResistance(field_77287_j, blockpos, (Entity)null, this);
                                 f -= (f2 + 0.3F) * 0.3F;
                             }
 
@@ -121,6 +131,26 @@
         }
 
         this.field_77281_g.addAll(set);
+        Event event;
+        List<org.bukkit.block.Block> blocks = new ArrayList<org.bukkit.block.Block>();
+        for(BlockPos pos : field_77281_g)
+        {
+            blocks.add(field_77287_j.getWorld().getBlockAt(pos.func_177958_n(),pos.func_177956_o(),pos.func_177952_p()));
+        }
+        if(field_77283_e == null)
+        {
+
+            event = new BlockExplodeEvent(field_77287_j.getWorld().getBlockAt((int)field_77284_b,(int)field_77285_c,(int)field_77282_d),blocks,field_77280_f);
+        }
+        else
+        {
+            event = new EntityExplodeEvent(field_77283_e.getBukkitEntity(),new Location(field_77287_j.getWorld(),(int)field_77284_b,(int)field_77285_c,(int)field_77282_d),blocks,field_77280_f);
+        }
+        CraftEventFactory.callEvent(event);
+        if(((Cancellable)event).isCancelled())
+        {
+           return;
+        }
         float f3 = this.field_77280_f * 2.0F;
         int k1 = MathHelper.func_76128_c(this.field_77284_b - (double)f3 - 1.0D);
         int l1 = MathHelper.func_76128_c(this.field_77284_b + (double)f3 + 1.0D);
@@ -129,6 +159,7 @@
         int j2 = MathHelper.func_76128_c(this.field_77282_d - (double)f3 - 1.0D);
         int j1 = MathHelper.func_76128_c(this.field_77282_d + (double)f3 + 1.0D);
         List<Entity> list = this.field_77287_j.func_72839_b(this.field_77283_e, new AxisAlignedBB((double)k1, (double)i2, (double)j2, (double)l1, (double)i1, (double)j1));
+        ForgeEventFactory.onExplosionDetonate(this.field_77287_j, this, list, f3);
         Vec3d vec3d = new Vec3d(this.field_77284_b, this.field_77285_c, this.field_77282_d);
 
         for (int k2 = 0; k2 < list.size(); ++k2)
@@ -228,8 +259,7 @@
                         block.func_180653_a(this.field_77287_j, blockpos, this.field_77287_j.func_180495_p(blockpos), 1.0F / this.field_77280_f, 0);
                     }
 
-                    this.field_77287_j.func_180501_a(blockpos, Blocks.field_150350_a.func_176223_P(), 3);
-                    block.func_180652_a(this.field_77287_j, blockpos, this);
+                    block.onBlockExploded(this.field_77287_j, blockpos, this);
                 }
             }
         }
@@ -266,4 +296,6 @@
     {
         return this.field_77281_g;
     }
+
+    public Vec3d getPosition(){ return this.position; }
 }
