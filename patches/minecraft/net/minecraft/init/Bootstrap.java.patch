--- ../src-base/minecraft/net/minecraft/init/Bootstrap.java
+++ ../src-work/minecraft/net/minecraft/init/Bootstrap.java
@@ -20,10 +20,7 @@
 import net.minecraft.dispenser.IBlockSource;
 import net.minecraft.dispenser.IPosition;
 import net.minecraft.enchantment.Enchantment;
-import net.minecraft.entity.Entity;
-import net.minecraft.entity.EntityList;
-import net.minecraft.entity.EntityLivingBase;
-import net.minecraft.entity.IProjectile;
+import net.minecraft.entity.*;
 import net.minecraft.entity.item.EntityBoat;
 import net.minecraft.entity.item.EntityExpBottle;
 import net.minecraft.entity.item.EntityFireworkRocket;
@@ -54,18 +51,23 @@
 import net.minecraft.tileentity.TileEntityDispenser;
 import net.minecraft.tileentity.TileEntityShulkerBox;
 import net.minecraft.tileentity.TileEntitySkull;
-import net.minecraft.util.EnumFacing;
-import net.minecraft.util.LoggingPrintStream;
-import net.minecraft.util.SoundCategory;
-import net.minecraft.util.SoundEvent;
-import net.minecraft.util.StringUtils;
+import net.minecraft.util.*;
 import net.minecraft.util.math.BlockPos;
+import net.minecraft.world.DimensionType;
 import net.minecraft.world.World;
 import net.minecraft.world.biome.Biome;
+import net.minecraftforge.common.util.EnumHelper;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
+import org.bukkit.craftbukkit.event.CraftEventFactory;
+import org.bukkit.craftbukkit.inventory.CraftItemStack;
+import org.bukkit.craftbukkit.projectiles.CraftBlockProjectileSource;
+import org.bukkit.event.block.BlockDispenseEvent;
+import org.bukkit.event.entity.CreatureSpawnEvent;
+import org.bukkit.event.inventory.InventoryType;
+import org.bukkit.util.Vector;
 
 public class Bootstrap
 {
@@ -187,15 +189,44 @@
                 double d0 = p_82487_1_.func_82615_a() + (double)enumfacing.func_82601_c();
                 double d1 = (double)((float)(p_82487_1_.func_180699_d().func_177956_o() + enumfacing.func_96559_d()) + 0.2F);
                 double d2 = p_82487_1_.func_82616_c() + (double)enumfacing.func_82599_e();
-                Entity entity = ItemMonsterPlacer.func_77840_a(p_82487_1_.func_82618_k(), ItemMonsterPlacer.func_190908_h(p_82487_2_), d0, d1, d2);
+                // CraftBukkit start
+                World world = p_82487_1_.func_82618_k();
+                ItemStack itemstack1 = p_82487_2_.func_77979_a(1);
+                org.bukkit.block.Block block = world.getWorld().getBlockAt(p_82487_1_.func_180699_d().func_177958_n(), p_82487_1_.func_180699_d().func_177956_o(), p_82487_1_.func_180699_d().func_177952_p());
+                CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
 
-                if (entity instanceof EntityLivingBase && p_82487_2_.func_82837_s())
-                {
+                BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new Vector(d0, d1, d2));
+                if (!BlockDispenser.eventFired) {
+                    world.getServer().getPluginManager().callEvent(event);
+                }
+
+                if (event.isCancelled()) {
+                    p_82487_2_.func_190917_f(1);
+                    return p_82487_2_;
+                }
+
+                if (!event.getItem().equals(craftItem)) {
+                    p_82487_2_.func_190917_f(1);
+                    // Chain to handler for new item
+                    ItemStack eventStack = CraftItemStack.asNMSCopy(event.getItem());
+                    IBehaviorDispenseItem idispensebehavior = (IBehaviorDispenseItem) BlockDispenser.field_149943_a.func_82594_a(eventStack.func_77973_b());
+                    if (idispensebehavior != IBehaviorDispenseItem.field_82483_a && idispensebehavior != this) {
+                        idispensebehavior.func_82482_a(p_82487_1_, eventStack);
+                        return p_82487_2_;
+                    }
+                }
+
+                itemstack1 = CraftItemStack.asNMSCopy(event.getItem());
+
+                Entity entity = ItemMonsterPlacer.spawnCreature(p_82487_1_.func_82618_k(), ItemMonsterPlacer.func_190908_h(p_82487_2_), event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ(), CreatureSpawnEvent.SpawnReason.DISPENSE_EGG);
+
+                if (entity instanceof EntityLivingBase && p_82487_2_.func_82837_s()) {
                     entity.func_96094_a(p_82487_2_.func_82833_r());
                 }
 
-                ItemMonsterPlacer.func_185079_a(p_82487_1_.func_82618_k(), (EntityPlayer)null, p_82487_2_, entity);
-                p_82487_2_.func_190918_g(1);
+                ItemMonsterPlacer.func_185079_a(p_82487_1_.func_82618_k(), (EntityPlayer) null, p_82487_2_, entity);
+                // itemstack.subtract(1);// Handled during event processing
+                // CraftBukkit end
                 return p_82487_2_;
             }
         });
@@ -207,9 +238,39 @@
                 double d0 = p_82487_1_.func_82615_a() + (double)enumfacing.func_82601_c();
                 double d1 = (double)((float)p_82487_1_.func_180699_d().func_177956_o() + 0.2F);
                 double d2 = p_82487_1_.func_82616_c() + (double)enumfacing.func_82599_e();
-                EntityFireworkRocket entityfireworkrocket = new EntityFireworkRocket(p_82487_1_.func_82618_k(), d0, d1, d2, p_82487_2_);
-                p_82487_1_.func_82618_k().func_72838_d(entityfireworkrocket);
-                p_82487_2_.func_190918_g(1);
+                // CraftBukkit start
+                World world = p_82487_1_.func_82618_k();
+                ItemStack itemstack1 = p_82487_2_.func_77979_a(1);
+                org.bukkit.block.Block block = world.getWorld().getBlockAt(p_82487_1_.func_180699_d().func_177958_n(), p_82487_1_.func_180699_d().func_177956_o(), p_82487_1_.func_180699_d().func_177952_p());
+                CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
+
+                BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new Vector(d0, d1, d2));
+                if (!BlockDispenser.eventFired) {
+                    world.getServer().getPluginManager().callEvent(event);
+                }
+
+                if (event.isCancelled()) {
+                    p_82487_2_.func_190917_f(1);
+                    return p_82487_2_;
+                }
+
+                if (!event.getItem().equals(craftItem)) {
+                    p_82487_2_.func_190917_f(1);
+                    // Chain to handler for new item
+                    ItemStack eventStack = CraftItemStack.asNMSCopy(event.getItem());
+                    IBehaviorDispenseItem idispensebehavior = (IBehaviorDispenseItem) BlockDispenser.field_149943_a.func_82594_a(eventStack.func_77973_b());
+                    if (idispensebehavior != IBehaviorDispenseItem.field_82483_a && idispensebehavior != this) {
+                        idispensebehavior.func_82482_a(p_82487_1_, eventStack);
+                        return p_82487_2_;
+                    }
+                }
+
+                itemstack1 = CraftItemStack.asNMSCopy(event.getItem());
+                EntityFireworkRocket entityfireworks = new EntityFireworkRocket(p_82487_1_.func_82618_k(), event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ(), itemstack1);
+
+                p_82487_1_.func_82618_k().func_72838_d(entityfireworks);
+                // itemstack.subtract(1); // Handled during event processing
+                // CraftBukkit end
                 return p_82487_2_;
             }
             protected void func_82485_a(IBlockSource p_82485_1_)
@@ -231,8 +292,38 @@
                 double d3 = random.nextGaussian() * 0.05D + (double)enumfacing.func_82601_c();
                 double d4 = random.nextGaussian() * 0.05D + (double)enumfacing.func_96559_d();
                 double d5 = random.nextGaussian() * 0.05D + (double)enumfacing.func_82599_e();
-                world.func_72838_d(new EntitySmallFireball(world, d0, d1, d2, d3, d4, d5));
-                p_82487_2_.func_190918_g(1);
+                // CraftBukkit start
+                ItemStack itemstack1 = p_82487_2_.func_77979_a(1);
+                org.bukkit.block.Block block = world.getWorld().getBlockAt(p_82487_1_.func_180699_d().func_177958_n(), p_82487_1_.func_180699_d().func_177956_o(), p_82487_1_.func_180699_d().func_177952_p());
+                CraftItemStack craftItem = CraftItemStack.asCraftMirror(itemstack1);
+
+                BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new Vector(d3, d4, d5));
+                if (!BlockDispenser.eventFired) {
+                    world.getServer().getPluginManager().callEvent(event);
+                }
+
+                if (event.isCancelled()) {
+                    p_82487_2_.func_190917_f(1);
+                    return p_82487_2_;
+                }
+
+                if (!event.getItem().equals(craftItem)) {
+                    p_82487_2_.func_190917_f(1);
+                    // Chain to handler for new item
+                    ItemStack eventStack = CraftItemStack.asNMSCopy(event.getItem());
+                    IBehaviorDispenseItem idispensebehavior = (IBehaviorDispenseItem) BlockDispenser.field_149943_a.func_82594_a(eventStack.func_77973_b());
+                    if (idispensebehavior != IBehaviorDispenseItem.field_82483_a && idispensebehavior != this) {
+                        idispensebehavior.func_82482_a(p_82487_1_, eventStack);
+                        return p_82487_2_;
+                    }
+                }
+
+                EntitySmallFireball fireball = new EntitySmallFireball(world, d0, d1, d2, event.getVelocity().getX(), event.getVelocity().getY(), event.getVelocity().getZ());
+                fireball.projectileSource = new CraftBlockProjectileSource((TileEntityDispenser) p_82487_1_.func_150835_j());
+
+                world.func_72838_d(fireball);
+                // itemstack.subtract(1); // Handled during event processing
+                // CraftBukkit end
                 return p_82487_2_;
             }
             protected void func_82485_a(IBlockSource p_82485_1_)
@@ -253,11 +344,60 @@
             {
                 ItemBucket itembucket = (ItemBucket)p_82487_2_.func_77973_b();
                 BlockPos blockpos = p_82487_1_.func_180699_d().func_177972_a((EnumFacing)p_82487_1_.func_189992_e().func_177229_b(BlockDispenser.field_176441_a));
-                return itembucket.func_180616_a((EntityPlayer)null, p_82487_1_.func_82618_k(), blockpos) ? new ItemStack(Items.field_151133_ar) : this.field_150841_b.func_82482_a(p_82487_1_, p_82487_2_);
+                // CraftBukkit start
+                World world = p_82487_1_.func_82618_k();
+                int x = blockpos.func_177958_n();
+                int y = blockpos.func_177956_o();
+                int z = blockpos.func_177952_p();
+                if (world.func_175623_d(blockpos) || !world.func_180495_p(blockpos).func_185904_a().func_76220_a()) {
+                    org.bukkit.block.Block block = world.getWorld().getBlockAt(p_82487_1_.func_180699_d().func_177958_n(), p_82487_1_.func_180699_d().func_177956_o(), p_82487_1_.func_180699_d().func_177952_p());
+                    CraftItemStack craftItem = CraftItemStack.asCraftMirror(p_82487_2_);
+
+                    BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new Vector(x, y, z));
+                    if (!BlockDispenser.eventFired) {
+                        world.getServer().getPluginManager().callEvent(event);
+                    }
+
+                    if (event.isCancelled()) {
+                        return p_82487_2_;
+                    }
+
+                    if (!event.getItem().equals(craftItem)) {
+                        // Chain to handler for new item
+                        ItemStack eventStack = CraftItemStack.asNMSCopy(event.getItem());
+                        IBehaviorDispenseItem idispensebehavior = (IBehaviorDispenseItem) BlockDispenser.field_149943_a.func_82594_a(eventStack.func_77973_b());
+                        if (idispensebehavior != IBehaviorDispenseItem.field_82483_a && idispensebehavior != this) {
+                            idispensebehavior.func_82482_a(p_82487_1_, eventStack);
+                            return p_82487_2_;
+                        }
+                    }
+
+                    itembucket = (ItemBucket) CraftItemStack.asNMSCopy(event.getItem()).func_77973_b();
+                }
+                // CraftBukkit end
+                if (itembucket.func_180616_a((EntityPlayer) null, p_82487_1_.func_82618_k(), blockpos)) {
+                    // CraftBukkit start - Handle stacked buckets
+                    Item item = Items.field_151133_ar;
+                    p_82487_2_.func_190918_g(1);
+                    if (p_82487_2_.func_190926_b()) {
+                        p_82487_2_.setItem(Items.field_151133_ar);
+                        p_82487_2_.func_190920_e(1);
+                    } else if (((TileEntityDispenser) p_82487_1_.func_150835_j()).func_146019_a(new ItemStack(item)) < 0) {
+                        this.field_150841_b.func_82482_a(p_82487_1_, new ItemStack(item));
+                    }
+                    // CraftBukkit end
+                    return p_82487_2_;
+                } else {
+                    return this.field_150841_b.func_82482_a(p_82487_1_, p_82487_2_);
+                }
+                //return itembucket.tryPlaceContainedLiquid((EntityPlayer)null, source.getWorld(), blockpos) ? new ItemStack(Items.BUCKET) : this.dispenseBehavior.dispense(source, stack);
             }
         };
         BlockDispenser.field_149943_a.func_82595_a(Items.field_151129_at, ibehaviordispenseitem);
         BlockDispenser.field_149943_a.func_82595_a(Items.field_151131_as, ibehaviordispenseitem);
+        BlockDispenser.field_149943_a.func_82595_a(Items.field_151117_aB, net.minecraftforge.fluids.DispenseFluidContainer.getInstance());
+        BlockDispenser.field_149943_a.func_82595_a(Items.field_151133_ar, net.minecraftforge.fluids.DispenseFluidContainer.getInstance());
+        if (false)
         BlockDispenser.field_149943_a.func_82595_a(Items.field_151133_ar, new BehaviorDefaultDispenseItem()
         {
             private final BehaviorDefaultDispenseItem field_150840_b = new BehaviorDefaultDispenseItem();
@@ -283,7 +423,29 @@
 
                     item = Items.field_151129_at;
                 }
+                // CraftBukkit start
+                org.bukkit.block.Block bukkitBlock = world.getWorld().getBlockAt(p_82487_1_.func_180699_d().func_177958_n(), p_82487_1_.func_180699_d().func_177956_o(), p_82487_1_.func_180699_d().func_177952_p());
+                CraftItemStack craftItem = CraftItemStack.asCraftMirror(p_82487_2_);
 
+                BlockDispenseEvent event = new BlockDispenseEvent(bukkitBlock, craftItem.clone(), new Vector(blockpos.func_177958_n(), blockpos.func_177956_o(), blockpos.func_177952_p()));
+                if (!BlockDispenser.eventFired) {
+                    world.getServer().getPluginManager().callEvent(event);
+                }
+
+                if (event.isCancelled()) {
+                    return p_82487_2_;
+                }
+
+                if (!event.getItem().equals(craftItem)) {
+                    // Chain to handler for new item
+                    ItemStack eventStack = CraftItemStack.asNMSCopy(event.getItem());
+                    IBehaviorDispenseItem idispensebehavior = (IBehaviorDispenseItem) BlockDispenser.field_149943_a.func_82594_a(eventStack.func_77973_b());
+                    if (idispensebehavior != IBehaviorDispenseItem.field_82483_a && idispensebehavior != this) {
+                        idispensebehavior.func_82482_a(p_82487_1_, eventStack);
+                        return p_82487_2_;
+                    }
+                }
+                // CraftBukkit end
                 world.func_175698_g(blockpos);
                 p_82487_2_.func_190918_g(1);
 
@@ -309,15 +471,40 @@
                 World world = p_82487_1_.func_82618_k();
                 this.field_190911_b = true;
                 BlockPos blockpos = p_82487_1_.func_180699_d().func_177972_a((EnumFacing)p_82487_1_.func_189992_e().func_177229_b(BlockDispenser.field_176441_a));
+                // CraftBukkit start
+                org.bukkit.block.Block block = world.getWorld().getBlockAt(p_82487_1_.func_180699_d().func_177958_n(), p_82487_1_.func_180699_d().func_177956_o(), p_82487_1_.func_180699_d().func_177952_p());
+                CraftItemStack craftItem = CraftItemStack.asCraftMirror(p_82487_2_);
 
+                BlockDispenseEvent event = new BlockDispenseEvent(block, craftItem.clone(), new Vector(0, 0, 0));
+                if (!BlockDispenser.eventFired) {
+                    world.getServer().getPluginManager().callEvent(event);
+                }
+
+                if (event.isCancelled()) {
+                    return p_82487_2_;
+                }
+
+                if (!event.getItem().equals(craftItem)) {
+                    // Chain to handler for new item
+                    ItemStack eventStack = CraftItemStack.asNMSCopy(event.getItem());
+                    IBehaviorDispenseItem idispensebehavior = (IBehaviorDispenseItem) BlockDispenser.field_149943_a.func_82594_a(eventStack.func_77973_b());
+                    if (idispensebehavior != IBehaviorDispenseItem.field_82483_a && idispensebehavior != this) {
+                        idispensebehavior.func_82482_a(p_82487_1_, eventStack);
+                        return p_82487_2_;
+                    }
+                }
+                // CraftBukkit end
+
                 if (world.func_175623_d(blockpos))
                 {
-                    world.func_175656_a(blockpos, Blocks.field_150480_ab.func_176223_P());
-
-                    if (p_82487_2_.func_96631_a(1, world.field_73012_v))
-                    {
-                        p_82487_2_.func_190920_e(0);
+                    // CraftBukkit start - Ignition by dispensing flint and steel
+                    if (!CraftEventFactory.callBlockIgniteEvent(world, blockpos.func_177958_n(), blockpos.func_177956_o(), blockpos.func_177952_p(), p_82487_1_.func_180699_d().func_177958_n(), p_82487_1_.func_180699_d().func_177956_o(), p_82487_1_.func_180699_d().func_177952_p()).isCancelled()) {
+                        world.func_175656_a(blockpos, Blocks.field_150480_ab.func_176223_P());
+                        if (p_82487_2_.func_96631_a(1, world.field_73012_v)) {
+                            p_82487_2_.func_190920_e(0);
+                        }
                     }
+                    // CraftBukkit end
                 }
                 else if (world.func_180495_p(blockpos).func_177230_c() == Blocks.field_150335_W)
                 {
@@ -496,6 +683,45 @@
             StatList.func_151178_a();
             Biome.func_185358_q();
             func_151353_a();
+            net.minecraftforge.fml.common.registry.GameData.vanillaSnapshot();
+            for(ResourceLocation rl : Potion.field_188414_b.func_148742_b())
+            {
+                if(!rl.func_110624_b().equals("minecraft"))
+                {
+                    EnumHelper.addBukkitPotionType(Potion.field_188414_b.func_82594_a(rl));
+                }
+            }
+            for(ResourceLocation rl : Item.field_150901_e.func_148742_b())
+            {
+                if(!rl.func_110624_b().equals("minecraft"))
+                {
+                    EnumHelper.addBukkitMaterial(Item.field_150901_e.func_82594_a(rl));
+                }
+            }
+            for(ResourceLocation rl : EntityList.func_180124_b())
+            {
+                if(!rl.func_110624_b().equals("minecraft"))
+                {
+                    String EntityName = rl.func_110623_a().toUpperCase();
+                    Class<? extends Entity> EntityClass = EntityList.getClass(rl);
+                    int typeId = EntityList.getID(EntityClass);
+                    EnumHelper.addBukkitEntity(EntityName,EntityClass,typeId,true);
+                }
+            }
+            for(DimensionType type : DimensionType.values())
+            {
+                if(type.func_186068_a() < -1 && type.func_186068_a() > 1)
+                {
+                    EnumHelper.addBukkitEnvironment(type);
+                }
+            }
+            for(ResourceLocation rl : Biome.field_185377_q.func_148742_b())
+            {
+                if(!rl.func_110624_b().equals("minecraft"))
+                {
+                    EnumHelper.addBukkitBiomeType(Biome.field_185377_q.func_82594_a(rl));
+                }
+            }
         }
     }
 
